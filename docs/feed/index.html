<?xml version="1.0" encoding="utf-8" ?>
<feed xmlns="http://www.w3.org/2005/Atom">
    <title><![CDATA[Martin Hujer blog]]></title>
    <link href="https://blog.martinhujer.cz/feed/" rel="self"/>
    <link href="https://blog.martinhujer.cz/"/>
    <updated>2023-04-03T15:25:17.678Z</updated>
    <id>https://blog.martinhujer.cz/</id>
    <author>
        <name>Martin Hujer</name>
        <email>mail@martinhujer.cz</email>
    </author>
    
        <entry>
            <title type="html"><![CDATA[My PHP and Symfony Development Setup on Windows]]></title>
            <link href="https://blog.martinhujer.cz/my-php-and-symfony-development-setup-on-windows/"/>
            <updated>2023-04-03T00:00:00.000Z</updated>
            <id>https://blog.martinhujer.cz/my-php-and-symfony-development-setup-on-windows/</id>
            <content type="html"><![CDATA[<p>I've been using the same setup for a local PHP and Symfony development since 2017 and now and then I still see someone is using a less efficient setup, so I decided it deserves a write-up.</p>
<h2 id="php-setup">PHP Setup</h2>
<p>Let's start with PHP itself. There are several options for running PHP locally. You can use XAMPP, WAMP, Docker or install PHP directly. Each of them has its pros and cons and my setup uses just plain PHP from windows.php.net.</p>
<p>All you need to do is to download the most recent PHP from <a href="https://windows.php.net/download/">windows.php.net</a>  (use the ZIP version <em>VS16 x64 Non Thread Safe</em>) and unpack it somewhere. In my case I use <code>C:/dev/php</code> to make the path short.</p>
<p>Next step is adding it to the system PATH so you can run it from anywhere with just <code>php</code>. (Google a guide on how to add a directory to system PATH if you are not sure how to do it.)</p>
<p>Now you can run <code>php -v</code> from a command line and it should print the PHP version (btw. I use <a href="https://cmder.app/">cmder</a> as my command line tool and it's awesome!).</p>
<h2 id="using-multiple-php-versions">Using multiple PHP versions</h2>
<p>Things usually get tricky, when you need to maintain more applications where each requires a different version of PHP.</p>
<p>What works great for me is to version the PHP installation directory using git. I create a separate branch for each version (<code>php81</code>, <code>php82</code> etc.) and checkout them when I need to work on some older stuff. I recommend using <a href="https://git-scm.com/docs/git-checkout#Documentation/git-checkout.txt---orphanltnew-branchgt">orphan branches</a> as it makes the git history cleaner.</p>
<p>When upgrading to a newer patch version (e.g., 8.2.3 → 8.2.4), I delete almost everything in the directory and unpack a newer version there. I keep the <code>php.ini</code> and some other files (see the next parts of the post).</p>
<p>I push the repo to GitLab which allows me to maintain the same PHP configuration across multiple devices.</p>
<p>Another advantage of this approach is that you can easily test upcoming PHP versions when they are in the beta phase to help discover potential bugs in PHP or incompatibilities in your app.</p>
<h2 id="composer-setup">Composer Setup</h2>
<p>To install Composer I recommend <a href="https://getcomposer.org/download/">downloading</a> <code>composer.phar</code> file (lower on the page, in <em>&quot;Manual Download&quot;</em> section) and placing it in the php directory (so it is versioned in git with the rest of the PHP setup - it was quite useful during transition from Composer v1 to v2 when usually the projects running on newer PHP versions used Composer v2 and older ones on older PHPs used v1).</p>
<p>To be able to run Composer with <code>composer</code> command from anywhere, create a <code>composer.cmd</code> file in the php directory with the following content:</p>
<pre><code class="cmd">php c:\dev\php\composer.phar %*
</code></pre>
<p>It runs <code>composer.phar</code> with <code>php</code> and passes all the parameters you provided.</p>
<p>Just don't forget to keep the <code>composer.phar</code> and <code>composer.cmd</code> files when upgrading the PHP as described above.</p>
<h2 id="webserver">Webserver</h2>
<p>The best way to run a Symfony application during development is to use the <a href="https://symfony.com/download">Symfony CLI</a>. But instead of using Scoop as they suggest I just download the zip linked bellow the <em>&quot;Binaries&quot;</em> heading and unzip it so the <code>symfony.exe</code> is in <code>C:/dev/php/symfony.exe</code>.</p>
<p>As we already have the <code>C:/dev/php</code> directory in the system PATH, we should be able to run <code>symfony</code> from command line anywhere.</p>
<p>To start the webserver, navigate to Symfony project directory and run <code>symfony server:start</code>. If you are using it for the first time, it will prompt you to install a newly generated root certificate so it can provide <code>https://</code> for locally running application.</p>
<p>After starting, it will display something like this, and you should be able to access the URL in the browser.</p>
<pre><code>[OK] Web server listening
      The Web server is using PHP CGI 8.2.4
      https://127.0.0.1:8000
</code></pre>
<h2 id="database-rabbitmq-etc-in-docker">Database, RabbitMQ, etc. in Docker</h2>
<p>I prefer to <a href="/jak-zacit-s-dockerem-od-zavislosti/">run everything else besides the webserver in Docker</a> (I mean MySQL, RabbitMQ, some mail catcher etc.). There are two main advantages:</p>
<ol>
<li>it allows you to easily switch versions either when upgrading the project or when working on multiple projects</li>
<li>it is easy to run Linux-first tools even if you use Windows for development</li>
</ol>
<p>You can do it by adding a <code>docker-composer.yml</code> file to you project and running <code>docker-compose up</code> from the CLI:</p>
<pre><code class="yaml">version: '3'
services:
    database:
        image: mariadb:10.3.18
        environment:
            - MYSQL_ROOT_PASSWORD=pass
        command:
            - --character-set-server=utf8mb4
            - --collation-server=utf8mb4_unicode_ci
        ports:
            - &quot;9101:3306&quot;

    mailer:
        image: maildev/maildev
        ports:
            - &quot;1080:1080&quot;
            - &quot;1025:1025&quot;

    rabbitmq:
        image: rabbitmq:3.11.11-management
        ports:
            - 5672:5672
            - 15672:15672
</code></pre>
<p>Symfony CLI <a href="https://symfony.com/doc/current/setup/symfony_server.html#docker-integration">supports Docker</a> therefore if you use standard ports in <code>docker-compose.yaml</code>, it will recognize the services and will automatically configure the ENV variables such as <code>DATABASE_URL</code> accordingly.</p>
<p>To utilize this automatic ENV variables setup for CLI, you have run the Symfony Commands with <code>symfony console</code>, instead of <code>php bin\console</code>:</p>
<pre><code class="cmd">symfony console doctrine:migrations:migrate
</code></pre>
<p>For accessing the database outside the application, I use <a href="https://www.heidisql.com/">HeidiSQL</a> which is Windows application for managing the database (I like it more than web tools such as Adminer or PhpMyAdmin).</p>
<h2 id="being-efficient-with-aliases">Being efficient with aliases</h2>
<p>I like using <a href="https://blog.martinhujer.cz/have-you-tried-composer-scripts/">Composer Scripts</a> to run dev tools included in the project such as PHPStan or PHP_CodeSniffer, but I hate typing long commands, so I have created an alias script in <code>C:/dev/php/x.cmd</code>:</p>
<pre><code class="cmd">php c:\dev\php\composer.phar %*
</code></pre>
<p>With that I can run <code>cs</code> script with <code>x cs</code> instead of <code>composer cs</code>. Similarly, for <code>composer install</code>, I just run <code>x inst</code>.</p>
<p>For running the Symfony Commands, I use another alias: <code>c.cmd</code>:</p>
<pre><code class="cmd">symfony console %*
</code></pre>
<p>Which allows me to run Symfony commands this way: <code>c doctrine:migrations:migrate</code></p>
<p>There is a cool feature in Symfony Command component which allows you to shorten the commands as long they are still unique. It means that <code>c d:m:m</code> will run <code>doctrine:migrations:migrate</code> if there isn't another command with same starting letters. And because Composer uses Symfony Command under the hood, the same applies to any Composer commands.</p>
<h2 id="conclusion">Conclusion</h2>
<p>What setup do you use for local development? Let me know in the comments! I would be delighted to learn how to optimize my setup even further.</p>
]]></content>
        </entry>
    
        <entry>
            <title type="html"><![CDATA[Anki AI - Add example sentences to Anki notes with ChatGPT]]></title>
            <link href="https://blog.martinhujer.cz/anki-ai-example-sentences-for-anki-with-chat-gpt/"/>
            <updated>2023-03-16T00:00:00.000Z</updated>
            <id>https://blog.martinhujer.cz/anki-ai-example-sentences-for-anki-with-chat-gpt/</id>
            <content type="html"><![CDATA[<p>I've been learning German for almost a year, and I already have around 3 000 notes in my Anki database (Anki is an app for learning vocabulary using spaced repetition technique). But unlike English, where I can get high quality example sentences from <a href="https://dictionary.cambridge.org/">Cambridge Dictionary</a>, I have yet to find similar source for German vocabulary.</p>
<p>When the new and cheaper <a href="https://platform.openai.com/docs/guides/chat">Chat Completion</a> API from OpenAI became available I thought it may be the way forward. I tried it in the Chat GPT first, and it worked pretty great (Chat Completion API allows you the access the model used in ChatGPT using the API):</p>
<p><img src="/data/2023/2023-03-16-anki-ai-example-sentences-for-anki-with-chat-gpt/anki-ai-1.png" alt="ChatGPT can generate example sentences for German vocabulary." /></p>
<p>I tried it again and prefixed the inputs with IDs so the output can be parsed more easily:</p>
<p><img src="/data/2023/2023-03-16-anki-ai-example-sentences-for-anki-with-chat-gpt/anki-ai-2.png" alt="ChatGPT can generate example sentences for German vocabulary with IDs." /></p>
<h2 id="using-gpt-to-generate-example-sentences-in-anki">Using GPT to Generate Example Sentences in Anki</h2>
<p>Using GPT for generating example sentences seemed viable, so I considered my options to use it to generate examples to my whole German vocabulary database in Anki.</p>
<p>Even though Anki allows you to create plugins, they must be written in Python, so I decided to use another approach. There is a <a href="https://github.com/FooSoft/anki-connect">Anki Connect</a> plugin which makes the Anki data available through REST API. I have been using quite a lot of  TypeScript recently (It's fun to use it!) so it was my first choice to writing my app.</p>
<p>Fetching the data from Anki was easy. Chat GPT even helped me craft regular expressions to clean up the vocabulary data. As a result, I only passed the words to the API.</p>
<p>Next, I had to create a prompt for the API. This is a final version which persuades the Chat API to return same format of the response every time:</p>
<blockquote>
<p><em>You are a helpful vocabulary learning assistant who helps user generate example sentences in German for language learning. I will provide each word prefixed by ID and you will generate two example sentences for each input. Each sentence in response must be on its own line and starting with ID I provided so it can be parsed with regex <code>/^(\d+): (.*)$/</code></em></p>
</blockquote>
<pre><code>1675192165662: Schulden machen
1675192165652: der Lieferant
1675192165655: vollkommen
</code></pre>
<p>With such input, you get response like this (interestingly, the sentences are different every time you try it):</p>
<pre><code>1675192165662: Man sollte sich immer genau überlegen, bevor Schulden gemacht werden
1675192165662: Schulden machen kann in der Zukunft zu großen finanziellen Problemen führen.
1675192165652: Der Lieferant hat das Paket heute Morgen geliefert.
1675192165652: Ich kann mich immer auf meinen Lieferanten verlassen.
1675192165655: Sie ist vollkommen glücklich mit ihrem neuen Job.
1675192165655: Das Essen war vollkommen in Ordnung, aber nicht besonders lecker.
</code></pre>
<p>The remaining steps were straightforward: parse the output and feed the data back into Anki.</p>
<h2 id="conclusion">Conclusion</h2>
<p>The simple script I created (you can <a href="https://github.com/mhujer/ankiai">check the source code on GitHub</a>) helped me generate the example sentences for my whole German database in Anki (~3 000 notes) and the API cost was around $0.5. That's why I did not bother optimizing the prompt length in any way (e.g., one optimization can be shortening the IDs, but there was no point in doing so).</p>
<p>I appreciate that the generated sentences are coherent and resemble real-world examples of the language (as far as I can tell).</p>
<p>If you want to try to use the script for your vocabulary, I added instructions to the <a href="https://github.com/mhujer/ankiai">README in the GitHub repository</a>.</p>
]]></content>
        </entry>
    
        <entry>
            <title type="html"><![CDATA[How to add a non-nullable column without downtime]]></title>
            <link href="https://blog.martinhujer.cz/how-to-add-non-nullable-column-without-downtime/"/>
            <updated>2021-04-05T00:00:00.000Z</updated>
            <id>https://blog.martinhujer.cz/how-to-add-non-nullable-column-without-downtime/</id>
            <content type="html"><![CDATA[<p>Database migrations are hard for many reasons. In this article I explain how to add a non-nullable column to an application when you are using Zero-Downtime deployments.</p>
<p><em>If you are using maintenance windows for releasing new versions, please read my article on why <a href="https://blog.martinhujer.cz/maintenance-window-antipattern/">Deploying only during maintenance windows is an antipattern</a>.</em></p>
<h2 id="what-is-the-problem">What is the problem?</h2>
<p>Even if your deployment process is automated, there may be a delay between when the database migration runs, and the new version of the application is deployed. It may be a minute or two if you have just one application server but longer if you have a fleet of servers, and you are deploying gradually.</p>
<p>When you add a new non-nullable column to a table, inserts on this table will fail, until the new version of the application is deployed to all nodes, because it will try to insert NULL into a non-nullable column.</p>
<p>You can think <em>&quot;Whatever...my deploy is fast. Nobody will notice.&quot;</em>, but please keep in mind that the deployment may fail at any phase - it may fail after the database migration was run but before the new code is deployed. Your production environment will be down until you can either roll back the database change or fix your deployment (npmjs down?).</p>
<p>Consider this example: you have simple todo-list app, and you want to allow users to decide whether the task is <code>simple</code> or <code>complex</code>. So in the new application version you add a <code>type</code> column and start inserting either <code>simple</code> or <code>complex</code> in that column.</p>
<pre><code class="sql">ALTER TABLE `tasks`	ADD COLUMN `type` VARCHAR(50) NOT NULL;
</code></pre>
<p>What happens? After you run the migration and before the application deployment will finish, no tasks can be added to the application because of the error:</p>
<pre><code class="sql">SQL Error (1364): Field 'type' doesn't have a default value
</code></pre>
<p>What can be done about it?</p>
<h2 id="it-s-all-about-backwards-compatibility">It's all about backwards compatibility</h2>
<p>The solution is simple - <strong>the database changes must be backwards compatible.</strong></p>
<p>The changes performed on the database must be also compatible with the currently deployed application version.</p>
<h2 id="step-1-add-a-nullable-column">Step 1: add a nullable column</h2>
<p>Instead of adding a non-nullable column, you add a nullable column first:</p>
<pre><code class="sql">ALTER TABLE `tasks` ADD COLUMN `type` VARCHAR(50) NULL;
</code></pre>
<p>Even after the change, the database is still compatible with the current application version.</p>
<h2 id="step-2-fill-the-column-in-the-application">Step 2: fill the column in the application</h2>
<p>If you are using an ORM or just prefer to keep all the logic in the application (because of testability), now it's time to update the entity to always set <code>type</code> column to value <code>simple</code>. This ensures that all new records will have a proper value set.</p>
<p>I usually do this in the same commit as Step 1 - I add the database field and update the entity to set a new field value. When deploying, the database is updated first, which is OK as the change is backwards compatible, and the code is deployed afterwards.</p>
<p>Note: We are not adding any complex logic yet!</p>
<h2 id="step-3-make-the-column-non-nullable">Step 3: make the column non-nullable</h2>
<p>Before the column can be made non-nullable, we must fill the values for the existing records. As we have only one task type now, we can do it like this:</p>
<pre><code class="sql">UPDATE tasks SET `type` = 'simple' WHERE `type` IS NULL;
</code></pre>
<p>At this point, there shouldn't be any NULL values left, so we can change the column to <code>NOT NULL</code>:</p>
<pre><code class="sql">ALTER TABLE `tasks` CHANGE COLUMN `type` `type` VARCHAR(50) NOT NULL;
</code></pre>
<h2 id="step-4-start-using-the-column">Step 4:  Start using the column</h2>
<p>Finally, you can change the application to allow choosing task type and deploy this version without any additional database changes.</p>
<p>If something goes wrong with the new application changes, you can easily revert to the previous application version without any changes to database structure.</p>
<h2 id="how-to-remove-the-non-nullable-column">How to remove the non-nullable column?</h2>
<p>Removing column is quite similar but backwards:</p>
<ol>
<li>Make the column nullable in the database.</li>
<li>Stop using the column in the application and deploy it.</li>
<li>Remove the column from the database.</li>
</ol>
<h2 id="how-to-rename-a-column-in-a-database">How to rename a column in a database?</h2>
<p>Renaming a column with zero downtime is hard (you need to add a new column and remove the old afterwards), so do it only when really necessary.</p>
<ol>
<li>Add a new nullable column to database.</li>
<li>Change the application, so it fills both columns with the same value (and deploy it).</li>
<li>Copy the values from the old column to the new column using SQL.</li>
<li>Make the new column non-nullable.</li>
<li>Change the application, so it always reads the new value (and deploy it).</li>
<li>Make the old column nullable.</li>
<li>Stop filling in the old column in the application (and deploy it).</li>
<li>Remove the old column from the database.</li>
</ol>
<h2 id="conclusion">Conclusion</h2>
<p>Adding a new non-nullable column to the database without downtime is more work that just running an <code>ALTER TABLE</code>, but it is worth it because it allows you to deploy changes anytime without waiting for a maintenance window.</p>
]]></content>
        </entry>
    
        <entry>
            <title type="html"><![CDATA[Deploying only during maintenance windows is an antipattern]]></title>
            <link href="https://blog.martinhujer.cz/maintenance-window-antipattern/"/>
            <updated>2021-04-04T00:00:00.000Z</updated>
            <id>https://blog.martinhujer.cz/maintenance-window-antipattern/</id>
            <content type="html"><![CDATA[<p>In this article I argue that deploying the new web application versions only during a maintenance window is an antipattern, and you should strive to have Zero-Downtime deployments.</p>
<p>It has long been a common practice to take a website or a web application down regularly and deploy a new version during that downtime. It is easy: You just schedule a 3-hour maintenance window between midnight and 3AM, make the application return <em>&quot;We are performing maintenance&quot;</em> page with an HTTP 503 code and do the upgrade or whatever during that time. And try to get some sleep afterwards.</p>
<p>Apart from the obvious advantages - nobody is messing with the application when you are releasing a new version, there are many reasons why it is not such a good idea:</p>
<ol>
<li>There is no natural maintenance window</li>
<li>It's better to sleep at night</li>
<li>The computers never sleep</li>
<li>Business won't wait for your maintenance window</li>
<li>Small changes are safer</li>
</ol>
<h2 id="1-there-is-no-natural-maintenance-window">1. There is no natural maintenance window</h2>
<p>There are natural maintenance windows only for a small part of the web applications - e.g., when you are working on a B2B application which is used only by business only during their business hours, and they are all in one time-zone.</p>
<p>When you are making a B2C application - ecommerce website or something like that, there is always going to be someone using your application. There are people working shifts, so they may be bored during a night shift and want to browse your website.</p>
<p>Or you go global and suddenly there is always someone's afternoon somewhere.</p>
<p>If you schedule maintenance window to the time when someone needs to use the application, you will annoy your existing users and lose any potential new customers who will visit the application during downtime.</p>
<p>And there are some questions which needs answering: What happens when someone filled a form a minute before the maintenance window and tries to submit it during the maintenance window? Will it fail? How? What about the data they entered?</p>
<p>Note: At least don't forget to send <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/503">proper HTTP 503 status code</a> or your temporary page may be indexed by search engines.</p>
<h2 id="2-it-s-better-to-sleep-at-night">2. It's better to sleep at night</h2>
<p>I'm a morning person (usually getting up at 7 AM, back at bed at 11 PM) so staying awake beyond midnight is really hard, and I guess I won't be very good at debugging a thorny production issue at 3 AM.</p>
<p>The more important is that messing up your sleep rhythm is bad for your health. If I stayed up until 3 AM, I would be useless the next day even after sleeping in. And my sleep rhythm will be disturbed for a few days at least. So, it is not worth it health- and productivity-wise.</p>
<h2 id="3-the-computers-never-sleep">3. The computers never sleep</h2>
<p>The computers never sleep, so even if there is a natural maintenance window, there may still be API calls coming to your application, webhooks may be called, etc. And depending on the 3rd party error handling, those may or may not be retried later.</p>
<h2 id="4-business-won-t-wait-for-your-maintenance-window">4. Business won't wait for your maintenance window</h2>
<p>If you can deploy new features only once every two weeks, the businesspeople in your company won't be happy having to wait up two weeks for a small change to go live. If they worked somewhere else where Zero-Downtime deployments where common, they would see you as incompetent.</p>
<p>Don't forget that if there is a competition moving faster than you, you risk losing customers to them.</p>
<h2 id="5-small-changes-are-safer">5. Small changes are safer</h2>
<p>Imagine there are 20 different changes in the release, and something breaks, or the load suddenly increases after the deployment. How will you debug it? It can be any of those 20 changes. If you did deploy only one change it would be both easier to debug the problem or rollback the change completely.</p>
<p>How do you rollback a big release with many database changes? And what if you discover the issue the day after the release? You cannot just revert to the older backup. You are out of luck.</p>
<h2 id="so-what-should-we-do-instead">So, what should we do instead?</h2>
<ul>
<li>Automate the deployment process</li>
<li>Deploy each change separately</li>
<li>Be careful about database migrations (I will write a separate post about database migrations without downtime)</li>
<li>Even if it may seem that the change warrants a maintenance window, try to think hard how to decompose it into several steps which may be deployed gradually without downtime.</li>
</ul>
<h2 id="conclusion">Conclusion</h2>
<p>When you consider the downsides discussed above, it does not seem that bad to spend some time on making your deployment process Zero-Downtime, right?</p>
<p>Please note that there are rare occasions when it is dramatically easier to schedule the maintenance window instead of doing it gradually (e.g., migrating the database to a new server). But those should be rare once-a-year special occasions, not part of your regular deployment process.</p>
]]></content>
        </entry>
    
        <entry>
            <title type="html"><![CDATA[Clever way to sort PHP arrays by multiple values]]></title>
            <link href="https://blog.martinhujer.cz/clever-way-to-sort-php-arrays-by-multiple-values/"/>
            <updated>2019-11-27T00:00:00.000Z</updated>
            <id>https://blog.martinhujer.cz/clever-way-to-sort-php-arrays-by-multiple-values/</id>
            <content type="html"><![CDATA[<p>In the post I will describe a clever trick which allows you to easily sort PHP array or collection by multiple values.</p>
<p>Let's start from the beginning. Sorting using <code>usort</code> and <code>uasort</code> functions works by providing a callback for comparing two values in the array. From the docs:</p>
<blockquote>
<p><em>The comparison function must return an integer less than, equal to, or greater than zero if the first argument is considered to be respectively less than, equal to, or greater than the second.</em></p>
</blockquote>
<h2 id="basic-sorting">Basic sorting</h2>
<p>The simplest example may look like this (when having an array of <code>Product</code> instances):</p>
<pre><code class="php">// order products by: price ASC
usort($products, function (Product $a, Product $b): int {
    return $a-&gt;getPrice() &lt;=&gt; $b-&gt;getPrice();
});
</code></pre>
<p>You can notice that I'm using a <em>spaceship operator</em> <code>&lt;=&gt;</code> which <a href="https://www.php.net/manual/en/migration70.new-features.php#migration70.new-features.spaceship-op">was added in PHP 7.0</a>. It compares two expressions, <code>$a</code> and <code>$b</code>, and returns -1, 0 or 1 when <code>$a</code> is respectively less than, equal to, or greater than <code>$b</code>.</p>
<p>The example above can be simplified more using the arrow functions from PHP 7.4 (although I wouldn't say that it is more readable):</p>
<pre><code class="php">usort($products, fn (Product $a, Product $b): int =&gt; $a-&gt;getPrice() &lt;=&gt; $b-&gt;getPrice());
</code></pre>
<p>To sort the values in the descending order, just swap <code>$a</code> and <code>$b</code> expressions in the callback:</p>
<pre><code class="php">// order products by: price DESC
usort($products, function (Product $a, Product $b): int {
    return $b-&gt;getPrice() &lt;=&gt; $a-&gt;getPrice();
});
</code></pre>
<h2 id="sorting-by-two-properties">Sorting by two properties</h2>
<p>If you want to sort the products by two fields, price ASC and products in stock first, it gets tricky.
First you need to check whether the prices are equal. If they are you compare the <code>inStock</code> flag to have the available products first. Otherwise just compare the prices.</p>
<pre><code class="php">// order products by: price ASC, inStock DESC
usort($products, function (Product $a, Product $b): int {
    if ($a-&gt;getPrice() === $b-&gt;getPrice()) {
        return $b-&gt;isInStock() &lt;=&gt; $a-&gt;isInStock();
    }
    return $a-&gt;getPrice() &lt;=&gt; $b-&gt;getPrice();
});
</code></pre>
<h2 id="sorting-by-multiple-properties">Sorting by multiple properties</h2>
<p>It will get much more complex when you want to sort the array by three or four properties:</p>
<pre><code class="php">// order products by: price ASC, inStock DESC, isRecommended DESC, name ASC
usort($products, function (Product $a, Product $b): int {
    if ($a-&gt;getPrice() === $b-&gt;getPrice()) {
        if ($a-&gt;isInStock() === $b-&gt;isInStock()) {
            if ($a-&gt;isRecommended() == $b-&gt;isRecommended()) {
                return $a-&gt;getName() &lt;=&gt; $b-&gt;getName();
            }
            return $b-&gt;isRecommended() &lt;=&gt; $a-&gt;isRecommended();
        }
        return $b-&gt;isInStock() &lt;=&gt; $a-&gt;isInStock();
    }
    return $a-&gt;getPrice() &lt;=&gt; $b-&gt;getPrice();
});
</code></pre>
<p>You have to carefully craft the conditions and don't miss the places where you are comparing <code>$b</code> with <code>$a</code> instead of <code>$a</code> with <code>$b</code> to sort them in descending order.</p>
<p>This example is quite close to what I needed when working on OutdoorVisit.com tickets list in activity detail. I couldn't do it in the database because there was some preprocessing (non-database filtering etc.) required.</p>
<p>I didn't want to have this complex sorting logic written as above, so I came up with the following solution.</p>
<h2 id="solution">Solution</h2>
<pre><code class="php">// order products by: price ASC, inStock DESC, isRecommended DESC, name ASC
usort($products, function (Product $a, Product $b): int {
    return
        ($a-&gt;getPrice() &lt;=&gt; $b-&gt;getPrice()) * 1000 + // price ASC
        ($b-&gt;isInStock() &lt;=&gt; $a-&gt;isInStock()) * 100 + // inStock DESC
        ($b-&gt;isRecommended() &lt;=&gt; $a-&gt;isRecommended()) * 10 + // isRecommended DESC
        ($a-&gt;getName() &lt;=&gt; $b-&gt;getName()); // name ASC
});
</code></pre>
<p>I compare all attributes that impact the sorting in the same expression. I also add weight to each comparison to prioritize them.</p>
<p>The trick is that the return value from the callback can be any positive or negative integer, not just -1 or 0 or 1. It allows me to sum the separate comparisons together and return it as a result.</p>
<p>It can be further simplified using arrow function from PHP 7.4:</p>
<pre><code class="php">// order products by: price ASC, inStock DESC, isRecommended DESC, name ASC
usort($products, fn (Product $a, Product $b): int =&gt;
    ($a-&gt;getPrice() &lt;=&gt; $b-&gt;getPrice()) * 1000 + // price ASC
    ($b-&gt;isInStock() &lt;=&gt; $a-&gt;isInStock()) * 100 + // inStock DESC
    ($b-&gt;isRecommended() &lt;=&gt; $a-&gt;isRecommended()) * 10 + // isRecommended DESC
    ($a-&gt;getName() &lt;=&gt; $b-&gt;getName()) // name ASC
);
</code></pre>
<h2 id="solution-from-frantisek-masa">Solution (from <a href="https://frantisekmasa.cz/">František Maša</a>)</h2>
<p><a href="https://frantisekmasa.cz/">František Maša</a> suggested even better solution in the comments. Thanks!</p>
<pre><code class="php">usort($products, fn (Product $a, Product $b): int =&gt;
    [$a-&gt;getPrice(), $b-&gt;isInStock(), $b-&gt;isRecommended(), $a-&gt;getName()]
    &lt;=&gt;
    [$b-&gt;getPrice(), $a-&gt;isInStock(), $a-&gt;isRecommended(), $b-&gt;getName()]
);
</code></pre>
<h2 id="conclusion">Conclusion</h2>
<p>Let me know in the comments if you find this trick useful.</p>
<p>Or do you have a better way of doing this?</p>
]]></content>
        </entry>
    
        <entry>
            <title type="html"><![CDATA[How to configure PHPStan for Symfony applications]]></title>
            <link href="https://blog.martinhujer.cz/how-to-configure-phpstan-for-symfony-applications/"/>
            <updated>2019-10-23T00:00:00.000Z</updated>
            <id>https://blog.martinhujer.cz/how-to-configure-phpstan-for-symfony-applications/</id>
            <content type="html"><![CDATA[<p><a href="https://github.com/phpstan/phpstan">PHPStan</a> is a fantastic tool for a static analysis of PHP code. It reads the code and PHPDoc and will try to detect potential issues such as:</p>
<ul>
<li>undefined variables</li>
<li>incorrect types passed throughout the codebase</li>
<li>use of non-existent methods and attributes</li>
<li>passing of incorrect number of parameters to a method</li>
<li>use of possible null-pointers</li>
<li>lot more...</li>
</ul>
<p>Apart from being able to analyse regular PHP code, PHPStan can understand even some framework-specific <em>magic</em> using custom-made extensions.</p>
<p>But let's start from the beginning...</p>
<h2 id="phpstan-installation">PHPStan installation</h2>
<p>You can install PHPStan either directly with all its dependencies by running:</p>
<pre><code class="bash">composer require --dev phpstan/phpstan
</code></pre>
<p>Or you can install <code>phpstan-shim</code>:</p>
<pre><code class="bash">composer require --dev phpstan/phpstan-shim
</code></pre>
<p>The advantage of <code>phpstan-shim</code> is that it is a Phar file with all the dependencies packed inside (and prefixed), so they won't conflict with other dependencies you may have in your project. Therefore, I prefer using <code>phpstan-shim</code>.</p>
<p>To have the extensions configured automatically, you need to install <a href="https://github.com/phpstan/extension-installer"><code>phpstan/extension-installer</code></a>:</p>
<pre><code class="bash">composer require --dev phpstan/extension-installer
</code></pre>
<h2 id="using-phpstan">Using PHPStan</h2>
<p>PHPStan can be run this way:</p>
<pre><code class="bash">vendor/bin/phpstan analyse -l 0 src tests
</code></pre>
<p>It will probably report bunch of errors depending on your project size and age. The best approach from here is to gradually fix the issues and raise the level of strictness (<code>-l 1</code> etc.).</p>
<p>If there are some issues which cannot be fixed easily, you can <a href="https://github.com/phpstan/phpstan#ignore-error-messages-with-regular-expressions">exclude them from the report</a>. When doing so, try to be specific and put the filename in the exclude, so you won't exclude the issues from the whole project. And don't forget to properly escape the regular expressions, or you may be excluding way more things than you wanted (hint: <code>|</code> needs to be escaped too). Those exclusions should be included in <code>phpstan.neon</code> configuration file (which is passed as <code>-c phpstan.neon</code> to the <code>analyse</code> command).</p>
<p>You should also have a look at a new <a href="https://medium.com/@ondrejmirtes/phpstans-baseline-feature-lets-you-hold-new-code-to-a-higher-standard-e77d815a5dff">Baseline Feature</a> in PHPStan, which allows you <em>ignore</em> all the current issues and let the PHPStan check just the new code.</p>
<h2 id="adding-phpstan-to-ci-build">Adding PHPStan to CI build</h2>
<p>To prevent issues from creeping back to the codebase, you should include PHPStan in you CI build to have it fail when a new error appears.</p>
<p>It can be done easily by using <a href="/have-you-tried-composer-scripts/">Composer Scripts</a>. Your <code>scripts</code> section in <code>composer.json</code> can look like this:</p>
<pre><code class="json">&quot;scripts&quot;: {
    &quot;phpstan&quot;: &quot;phpstan analyse -c phpstan.neon src tests --level 7 --no-progress&quot;, 
    &quot;tests&quot;: &quot;phpunit&quot;,    
    &quot;ci&quot;: [
        &quot;@phpstan&quot;,
        &quot;@tests&quot;
    ],
}
</code></pre>
<p>It will run both the <code>phpstan</code> and <code>tests</code> scripts when you run <code>composer ci</code>.</p>
<p><strong>Note:</strong> If you have a Symfony application, you will already have a <code>scripts</code> section in your <code>composer.json</code>, so just add new items there.</p>
<p>You can read more thoroughly about Composer Scripts in my article <em><a href="/have-you-tried-composer-scripts/">Have you tried Composer Scripts? You may not need Phing</a></em>.</p>
<h2 id="configuring-the-symfony-extension">Configuring the Symfony extension</h2>
<p>You might have noticed that PHPStan reports some issues in Symfony-specific code, that works OK. It is because there is no way for PHPStan to understand Symfony magic just from the code itself. It includes getting services from Container (you should not be doing it anyway!), working with arguments and options in Commands and much more.</p>
<p>To have those errors disappear, you need to install <a href="https://github.com/phpstan/phpstan-symfony">phpstan/phpstan-symfony</a> extension and provide PHPStan with a path to Symfony container compiled to XML. It is usually stored in the <code>var/cache/dev</code> directory. The following configuration should be added to <code>phpstan.neon</code> file:</p>
<pre><code class="yaml">parameters:
    symfony:
        container_xml_path: var/cache/dev/srcApp_KernelDevDebugContainer.xml
</code></pre>
<p>Also, to have the Commands analysed properly, PHPStan needs a <em>console loader</em>. It is a script that initializes the Symfony Console for the application and passes it to PHPStan. It can use it to determine the arguments or options types etc.</p>
<p>I usually put it in <code>build/phpstan/console-loader.php</code>:</p>
<pre><code class="php">&lt;?php declare(strict_types = 1);

use App\Kernel;
use Symfony\Bundle\FrameworkBundle\Console\Application;

require dirname(__DIR__) . '/../config/bootstrap.php';
$kernel = new Kernel($_SERVER['APP_ENV'], (bool) $_SERVER['APP_DEBUG']);
return new Application($kernel);
</code></pre>
<p>The configuration file <code>phpstan.neon</code> should look like this:</p>
<pre><code class="neon">parameters:
    symfony:
        container_xml_path: var/cache/dev/srcApp_KernelDevDebugContainer.xml
        console_application_loader: build/phpstan/console-loader.php
</code></pre>
<p>With this configuration, PHPStan can understand the Symfony code. It also checks that you are not fetching non-existent (or private) services from container.</p>
<h2 id="configuring-phpstan-with-phpunit">Configuring PHPStan with PHPUnit</h2>
<p>In the previous part we have successfully configured PHPStan to check various things in Symfony projects. However, it is still possible to improve the configuration.</p>
<p>We are now using same configuration file for both <code>src</code> and <code>tests</code>, but Symfony uses a separate container when running in either <code>dev</code> or <code>test</code> environments. It means that PHPStan will report errors such as <code>Service &quot;Doctrine\ORM\EntityManagerInterface&quot; is private.</code> even if the tests work fine.</p>
<p>The solution is simple - use a separate configuration file for <code>src</code> and for <code>tests</code>. We can keep the current <code>phpstan.neon</code>, but we have to create specific configuration for tests - <code>phpstan-tests.neon</code>. It will look very similarly with only change being the <code>container_xml_path</code> which now points to the container compiled in <code>var/cache/test</code>:</p>
<pre><code class="neon">parameters:
    symfony:
        container_xml_path: var/cache/test/srcApp_KernelTestDebugContainer.xml
        console_application_loader: build/phpstan/console-loader.php
</code></pre>
<p>You need to adjust the <code>scripts</code> setup in <code>composer.json</code> to run PHPStan twice - first for the <code>src</code> directory and then for the <code>tests</code> with a different configuration file. When using this setup, you can still run <code>composer phpstan</code> which in turn runs checks for both <code>src</code> and <code>tests</code>.</p>
<pre><code class="json">&quot;phpstan&quot;: [
    &quot;@phpstan-general&quot;,
    &quot;@phpstan-tests&quot;
],
&quot;phpstan-general&quot;: &quot;phpstan analyse -c phpstan.neon src --level 7 --no-progress&quot;,
&quot;phpstan-tests&quot;: &quot;phpstan analyse -c phpstan-tests.neon tests --level 7 --no-progress&quot;,
</code></pre>
<p>I know that the PHPStan configuration is duplicated a little bit, but that does not matter much (you are not adding new extensions that often).</p>
<p>One thing that you must keep in mind is that the Symfony container must be compiled before it can be used for analysis. You can do it by running <code>bin/console cache:warmup --env=dev</code> and <code>bin/console cache:warmup --env=test</code>. As it needs to be part of the CI build, you can put it to the Composer <code>scripts</code> as well:</p>
<pre><code class="json">&quot;phpstan&quot;: [
    &quot;@php bin/console cache:warmup --env=dev&quot;,
    &quot;@php bin/console cache:warmup --env=test&quot;,
    &quot;@phpstan-general&quot;,
    &quot;@phpstan-tests&quot;
],
</code></pre>
<p>Or you can put it into a separate script, so it won't be slowing you down when running PHPStan repeatedly without changes in the container (but you must make sure that the container is recompiled for the <code>test</code> environment after change).</p>
<p>Finally, we are getting to configuring the <a href="https://github.com/phpstan/phpstan-phpunit">PHPUnit extension</a> itself. We need to install it through Composer:</p>
<pre><code class="bash">composer require --dev phpstan/phpstan-phpunit
</code></pre>
<p>It will be included automatically thanks to the <code>phpstan/extension-installer</code> we installed in the beginning. So that's it.</p>
<h2 id="phpstan-and-doctrine-orm">PHPStan and Doctrine ORM</h2>
<p>Doctrine ORM contains even more magic things which can't be inferred just from the code itself. Repository and Entity Manager use <code>object</code> type in lot of places, so the PHPStan won't know which type is there and you would need to add lots of inline PHPDoc to make it work.</p>
<p>Or you can install <a href="https://github.com/phpstan/phpstan-doctrine"><code>phpstan/phpstan-doctrine</code></a> extension which helps PHPStan to understand Doctrine magic.</p>
<pre><code class="bash">composer require --dev phpstan/phpstan-doctrine
</code></pre>
<p>Like with Symfony extension, you must help Doctrine extension by creating a loader script that provides an Entity Manager so PHPStan can query it about various things. I usually put it into
<code>build/phpstan/doctrine-orm-bootstrap.php</code> and the script should look like this:</p>
<pre><code class="php">&lt;?php declare(strict_types = 1);

use App\Kernel;

require dirname(__DIR__) . '/../config/bootstrap.php';
$kernel = new Kernel($_SERVER['APP_ENV'], (bool) $_SERVER['APP_DEBUG']);
$kernel-&gt;boot();
return $kernel-&gt;getContainer()-&gt;get('doctrine')-&gt;getManager();
</code></pre>
<p>You should add this to respective sections in both <code>phpstan.neon</code> and <code>phpstan-tests.neon</code>:</p>
<pre><code class="neon">parameters:
    doctrine:
        objectManagerLoader: build/phpstan/doctrine-orm-bootstrap.php
</code></pre>
<p>With this setup PHPStan will use the EntityManager to also check your DQLs and Query Builders, which is awesome.</p>
<p>Next version of PHPStan-Doctrine extension will also support analysis of the entity annotations to determine whether the property type matches the column type, whether the property types for associations are defined correctly etc.</p>
<h2 id="bleeding-edge-features">Bleeding edge features</h2>
<p>PHPStan can check even more things when you enable <em>bleeding edge</em> rules from the core of PHPStan. Current PHPStan release is 0.11.x is mostly backwards compatible (not that many new issues are detected between patch versions). However, Ondra practices something along the lines of the trunk-based development, where new features (checks!) are hidden behind feature flags.</p>
<p>You can enable all of them by adding this to your configuration files (applies to <code>phpstan-shim</code>, the path will be different for a regular installation):</p>
<pre><code class="neon">includes:
    - phar://phpstan.phar/conf/bleedingEdge.neon
</code></pre>
<h2 id="strict-rules">Strict rules</h2>
<p>There is a <a href="https://github.com/phpstan/phpstan-strict-rules"><code>phpstan/phpstan-strict-rules</code></a> package which adds opinionated checks not included in the PHPStan core. You can install it through Composer:</p>
<pre><code class="bash">composer require --dev phpstan/phpstan-strict-rules
</code></pre>
<p>And suddenly you will get many more potential issues or bad practices reported :-)</p>
<h2 id="conclusion">Conclusion</h2>
<p>If you configure the PHPStan according to this article, it will change your life :-) (at least a little bit).</p>
<p>Nowadays I can't imagine developing modern PHP applications without PHPStan running on max level with lots of checks. It helps to prevent many issues during development and refactoring of the applications.</p>
]]></content>
        </entry>
    
        <entry>
            <title type="html"><![CDATA[Jaké novinky přinese PHP 7.4]]></title>
            <link href="https://blog.martinhujer.cz/jake-novinky-prinese-php-7-4/"/>
            <updated>2019-10-07T00:00:00.000Z</updated>
            <id>https://blog.martinhujer.cz/jake-novinky-prinese-php-7-4/</id>
            <content type="html"><![CDATA[<p>Vydání PHP 7.4 je plánováno na 28. listopadu 2019. Přináší hromadu zajímavých věcí – Typed Properties, Arrow Functions, Preload, FFI a pár dalších vylepšení. Sice přibyly i nějaké deprecations, ale typicky se týkají podivného chování, takže upgrade by měl být snadný.</p>
<p><strong><a href="https://www.zdrojak.cz/clanky/jake-novinky-prinese-php-7-4/">Článek vyšel</a> na serveru Zdroják.cz</strong></p>
]]></content>
        </entry>
    
        <entry>
            <title type="html"><![CDATA[How to use Data Providers in PHPUnit]]></title>
            <link href="https://blog.martinhujer.cz/how-to-use-data-providers-in-phpunit/"/>
            <updated>2019-09-03T00:00:00.000Z</updated>
            <id>https://blog.martinhujer.cz/how-to-use-data-providers-in-phpunit/</id>
            <content type="html"><![CDATA[<blockquote>
<p>I think that even if you are already using Data Providers, you will find some of those tips useful.</p>
</blockquote>
<p>Data Providers are a handy feature of PHPUnit which allows you to run the same test with different inputs and expected results. This is useful when you are writing some text filtering, transformations, URL generation, price calculations, etc.</p>
<p>Let's say you are implementing your own <code>trim</code> function and you need to test it with lots of tests like the following one:</p>
<pre><code class="php">&lt;?php

public function testTrimTrimsLeadingSpace(): void
{
    $input = ' Hello World';
    $expectedResult = 'Hello World';

    self::assertSame($expectedResult, trim($input));
}
</code></pre>
<p>Instead of duplicating the test method and just changing the inputs, you can use Data Providers:</p>
<pre><code class="php">&lt;?php

/**
 * @dataProvider provideTrimData
 */
public function testTrim($expectedResult, $input): void
{
    self::assertSame($expectedResult, trim($input));
}

public function provideTrimData()
{
    return [
        [
            'Hello World',
            ' Hello World',
        ],
        [
            'Hello World',
            &quot; Hello World \n&quot;,
        ],
    ];
}
</code></pre>
<p><strong>Data Provider</strong> is just a regular public method in the test case class which returns an array of arrays.</p>
<ul>
<li>You link it to the test method with a <code>@dataProvider</code> annotation followed by the method name.</li>
<li>Parameters returned from the data provider are added to the method definition. (I prefer to pass the <em>expected</em> value as a first parameter to match the <code>assert*</code> methods)</li>
<li>PHPUnit runs the test method with each data set as a separate test.</li>
</ul>
<p>Here is a screenshot of running the test above in PhpStorm:
<img src="/data/2019/2019-09-03-how-to-use-data-providers-in-phpunit/phpunit-basic-data-providers.png" alt="PHPUnit: basic data providers in PhpStorm" /></p>
<p>Now you know how to use basic Data Providers. In the rest of the article I will dive into more advanced stuff and tips.</p>
<h2 id="tip-1-always-name-the-data-providers">Tip #1: Always name the data providers</h2>
<p>By default, each data provider is referenced by its array index. It means that when running it, PHPUnit will tell you, that the test failed <em>with data set #0</em>.</p>
<p>To prevent confusion when having lot of data providers, you should always name them. Because the data provider method returns a regular array, it is as easy as adding keys there:</p>
<pre><code class="php">&lt;?php

public function provideTrimData()
{
    return [
        'leading space is trimmed' =&gt; [
            'Hello World',
            ' Hello World',
        ],
        'trailing space and newline are trimmed' =&gt; [
            'Hello World',
            &quot;Hello World \n&quot;,
        ],
        'space in the middle is removed' =&gt; [
            'HelloWorld',
            &quot;Hello World&quot;,
        ],
    ];
}
</code></pre>
<p>It makes test results much easier to understand:</p>
<p><img src="/data/2019/2019-09-03-how-to-use-data-providers-in-phpunit/phpunit-named-data-providers.png" alt="PHPUnit: named data providers in PhpStorm" /></p>
<p>I recommend that you name the data sets the same way you would use for separate tests.</p>
<h2 id="tip-2-you-can-run-single-data-set-from-data-provider">Tip #2: You can run single data set from data provider</h2>
<p>When there is something wrong with one of the data sets, you probably want to run the test only with it. You can do so by using PHPUnit's <code>--filter</code> option in CLI.</p>
<p>Here are examples of what is possible (the documentation shows examples with <code>'</code>, but that does not work on Windows, where you have to use <code>&quot;</code> to wrap the argument):</p>
<ul>
<li><code>--filter &quot;testTrimTrims#2&quot;</code> runs data set #2 (third data set, as the array keys start at zero)</li>
<li><code>--filter &quot;testTrimTrims#0-2&quot;</code> runs data sets #0, #1 and #2</li>
<li><code>--filter &quot;testTrimTrims@trailing space and newline are trimmed&quot;</code> runs specific named data set</li>
<li><code>--filter &quot;testTrimTrims@.*space.*&quot;</code> runs named data sets that match the regexp</li>
</ul>
<p>Don't forget to check <a href="https://phpunit.readthedocs.io/en/8.3/textui.html#textui-examples-filter-patterns">the other possible patterns in docs</a>.</p>
<p>PhpStorm does not currently allow you to run a single data set from the code (please vote for the issue <a href="https://youtrack.jetbrains.com/issue/WI-43933">WI-43933</a>), but you can run all of them and then <a href="https://blog.jetbrains.com/phpstorm/2017/12/phpunit-support-enhancements/">rerun one from the test results</a>. When you have the JetBrains issue tracker open, please also vote for <a href="https://youtrack.jetbrains.com/issue/WI-43811">WI-43811</a> (possibility to go to the data set from the test results).</p>
<p>When I want to run a single data set from the PhpStorm I usually just comment out all the other data sets.</p>
<h2 id="tip-3-add-type-definitions">Tip #3: Add type definitions</h2>
<p>I always add type hints to the method definitions when possible. When using data providers, it means adding parameter type hints to the method that accepts data sets and adding a return type (and phpdoc) to data provider method:</p>
<pre><code class="php">&lt;?php

/**
 * @dataProvider provideTrimData
 */
public function testTrimTrims(
    string $expectedOutput,    // &lt;-- added typehint here
    string $input              // &lt;-- added typehint here
): void
{
    self::assertSame($expectedOutput, trim($input));
}

/**
 * @return string[][]          // &lt;-- added typehint here
 */
public function provideTrimData(): array     // &lt;-- added typehint here
{
    return [
        'leading space is trimmed' =&gt; [
            'Hello World',
            ' Hello World',
        ],
        'trailing space and newline are trimmed' =&gt; [
            'Hello World',
            &quot;Hello World \n&quot;,
        ],
    ];
}
</code></pre>
<p>If you need to have a nullable type in the test method, I recommend splitting it into two separate methods and data providers. Instead of having <code>testTransformData(?string $expectedResult, string $input)</code> with a nullable parameter I would create those:</p>
<p><code>testTransformData(string $expectedResult, string $input)</code>
<code>testTransformingInvalidDataReturnsNull(string $invalidInput)</code></p>
<h2 id="tip-4-data-providers-are-supported-well-in-phpstorm">Tip #4: Data providers are supported well in PhpStorm</h2>
<p>Despite the issues I mentioned above (<a href="https://youtrack.jetbrains.com/issue/WI-43933">WI-43933</a> and <a href="https://youtrack.jetbrains.com/issue/WI-43811">WI-43811</a>) I think that Data providers support in PhpStorm is quite good.</p>
<p>When you reference non-existing data provider, you can use quick action to generate it:
<img src="/data/2019/2019-09-03-how-to-use-data-providers-in-phpunit/create-data-provider-quick-action.png" alt="PhpStorm: create data provider quick action" /></p>
<p>Auto-completion of data provider name works in the <code>@dataProvider</code> annotation:
<img src="/data/2019/2019-09-03-how-to-use-data-providers-in-phpunit/phpstorm-data-provider-autocompletion.png" alt="PhpStorm: rename data provider refactoring" /></p>
<p>Renaming the data provider using Rename refactoring also works as expected:
<img src="/data/2019/2019-09-03-how-to-use-data-providers-in-phpunit/phpstorm-rename-data-provider-refactoring.png" alt="PhpStorm: rename data provider refactoring" /></p>
<h2 id="tip-5-more-complex-data-providers">Tip #5: More complex data providers</h2>
<p>Instead of having a static array written in the code, the data providers can be more complex and prepare the data set dynamically.</p>
<p>For example, when having the external data, you can easily generate resulting array this way:</p>
<pre><code class="php">&lt;?php
/**
 * @return string[][]
 */
public function provideSpams(): array
{
    $spamStrings = require __DIR__ . '/fixtures/spams.php';

    $result = [];
    foreach ($spamStrings as $spamString) {
        $result[mb_substr($spamString, 0, 40)] = [$spamString];
    }

    return $result;
}
</code></pre>
<p>You should be careful with adding lot of logic to the data provider. Otherwise you would have to write a test that tests the data provider...</p>
<p>You can even return instances from the data provider:</p>
<pre><code class="php">&lt;?php

public function provideDateTimesPartOfDay(): array
{
    return [
        [
            'morning',
            new DateTimeImmutable('2018-10-01 10:00:00'),
        ],
        [
            'afternoon',
            new DateTimeImmutable('2019-09-01 15:00:00'),
        ],
    ];
}
</code></pre>
<h2 id="tip-6-you-can-use-closures-in-data-providers-to-delay-evaluation">Tip #6: You can use Closures in Data providers to delay evaluation</h2>
<p>The disadvantage of data providers is that they are evaluated before anything else (to allow PHPUnit calculate the total number of tests). It means that they can't access anything initialized in <code>setUpBeforeClass()</code> or <code>setUp()</code>.</p>
<p>You can work around this limitation by returning closures from data providers. Have a look at the code bellow - data provider returns a closure which is called in the test itself.</p>
<pre><code class="php">&lt;?php

/**
 * @dataProvider provideDateTransformations
 */
public function testWithClosuresInDataProvider(
    string $expectedResult,
    Closure $setTime
): void
{
    $dateTime = new DateTime('2019-09-01');

    $setTime($dateTime);

    self::assertSame($expectedResult, $dateTime-&gt;format('Y-m-d H:i:s'));
}

public function provideDateTransformations()
{
    return [
        'midnight' =&gt; [
            '2019-09-01 00:00:00',
            function (DateTime $date): void {
                $date-&gt;setTime(0, 0, 0);
            },
        ],
        '3 o\'clock in the afternoon' =&gt; [
            '2019-09-01 15:00:00',
            function (DateTime $date): void {
                $date-&gt;setTime(15, 0, 0);
            },
        ],
    ];
}
</code></pre>
<h2 id="tip-7-use-yield-to-simplify-large-nested-arrays">Tip #7: Use <code>yield</code> to simplify large nested arrays</h2>
<p>Instead of having large arrays in the data provider, you can use yield for each data set:</p>
<pre><code class="php">&lt;?php
public function provideTrimData()
{
    yield 'leading space is trimmed' =&gt; [
        'Hello World',
        ' Hello World',
    ];
    yield 'trailing space and newline are trimmed' =&gt; [
        'Hello World',
        &quot;Hello World \n&quot;,
    ];
    yield 'space in the middle is removed' =&gt; [
        'HelloWorld',
        'Hello World',
    ];
}
</code></pre>
<p>I think it may help with code readability for large arrays. However similarly to arrays, all yields are evaluated before tests start (PHPUnit calculates the total number of tests before running them).</p>
<h2 id="tip-8-don-t-use-testwith-annotation">Tip #8: Don't use <code>@testWith</code> annotation</h2>
<p>Instead of using a separate method for data provider, PHPUnit supports inlining the data sets as JSON in PHPDoc using the <a href="https://phpunit.readthedocs.io/en/8.3/annotations.html#testwith"><code>@testWith</code></a> annotation.</p>
<pre><code class="php">&lt;?php
/**
 * @testWith
 *        [&quot;Hello World&quot;, &quot; Hello World&quot;]
 *        [&quot;Hello World&quot;, &quot;Hello World \n&quot;]
 *
 */
public function testTrim($expectedResult, $input): void
{
    self::assertSame($expectedResult, trim($input));
}

</code></pre>
<p><strong>Please do not use this, because PHPDocs is not a good place to put your code:</strong></p>
<ul>
<li>syntax highlighting does not work there</li>
<li>IDE code validation does not work there</li>
<li>automatic code formatting does not work there</li>
<li>it cannot be analysed statically by PHPStan</li>
</ul>
<h2 id="conclusion">Conclusion</h2>
<p>Do you have other tips to use Data Providers even more efficiently? Please share them in the comments!</p>
]]></content>
        </entry>
    
        <entry>
            <title type="html"><![CDATA[Don&#39;t put .idea and .vscode directories to project&#39;s .gitignore]]></title>
            <link href="https://blog.martinhujer.cz/dont-put-idea-vscode-directories-to-projects-gitignore/"/>
            <updated>2019-08-26T00:00:00.000Z</updated>
            <id>https://blog.martinhujer.cz/dont-put-idea-vscode-directories-to-projects-gitignore/</id>
            <content type="html"><![CDATA[<blockquote>
<p><strong>tl;dr:</strong> Don't put <code>.idea</code> and <code>.vscode</code> directories to project's <code>.gitignore</code>. You should configure a global <code>.gitignore</code> for your machine instead.</p>
</blockquote>
<p>When you are using git (or any other version control), there are some temporary files in the directory structure, which should not be included in the repository. Usually they are listed in the <code>.gitignore</code> file in the project root directory.</p>
<p><strong>What if I told you that there are other ways to exclude temporary files from the project? There are three.</strong></p>
<h2 id="1-gitignore-file-in-the-project-s-root">1. .gitignore file in the project's root</h2>
<p><code>.gitignore</code> in the project is the most important one. In it you should list any files or directories which are created by the application itself. Best examples are cache files, logs, local configs etc.</p>
<p>In the Symfony application your <code>.gitignore</code> may look like this (I included an explanation on each line):</p>
<pre><code class=".gitignore">/.env.local   &lt;-- local config
/.env.*.local   &lt;-- local config
/var/   &lt;-- cache and logs
/vendor/   &lt;-- dependencies installed through Composer

# PHPUnit
/phpunit.xml   &lt;-- local PHPUnit config used for overriding the default phpunit.xml.dist
.phpunit.result.cache   &lt;-- PHPUnit cache files

# PHPCS
/phpcs.xml   &lt;-- local PHPCS config used for overriding the default phpcs.xml.dist
.php_cs.cache   &lt;-- PHPCS cache file
</code></pre>
<p>The important thing is that those files are created by the application itself by either building it, running it or doing some work on it.</p>
<h2 id="2-global-gitignore-for-your-machine">2. Global .gitignore for your machine</h2>
<p>Some files or directories present in the application directory are not created by the application itself, but by the operating system or other applications. Those shouldn't be excluded using the project's <code>.gitignore</code>, because they may differ from developer to developer.</p>
<p>Common examples are <code>.idea</code> (PhpStorm), <code>.vscode</code> (VS Code), <code>Thumbs.db</code> (Windows thumbnails cache), <code>.DS_Store</code> (some macOS cache).</p>
<p>There is a perfect place for them - the global <code>.gitignore</code> file for the machine. When you add something there, it is ignored in any repository, so you don't have to exclude those files in every project you happen to be working on.</p>
<p>You configure the path to the global <code>.gitignore</code> in the <code>.gitconfig</code> file which usually resides in your home directory:</p>
<pre><code># add this to ~/.gitconfig:

[core]
    excludesfile = ~/.gitignore
</code></pre>
<p>And create the <code>.gitignore</code> file in your home directory:</p>
<pre><code class=".gitignore"># create ~/.gitignore

# PhpStorm
.idea

# VSCode
.vscode
</code></pre>
<p>From now on, those will be ignored in any git repository on your machine.</p>
<p>Quite often I see people adding those anyway. From a quick Github search you can see that there are almost 200k results for commits which mention some commonly ignored directory:</p>
<ul>
<li><code>.vscode</code> <a href="https://github.com/search?q=gitignore+.vscode&amp;type=Commits">27K results</a></li>
<li><code>.DS Store</code> <a href="https://github.com/search?q=gitignore+.DS_Store&amp;type=Commits">68K results</a></li>
<li><code>.idea</code> <a href="https://github.com/search?q=gitignore+.idea&amp;type=Commits">100K results</a></li>
</ul>
<p>There is no point in adding those for the internally developed applications, as you can nudge each developer to properly configure his workstation. But if you are managing an open-source application or library, you may want to make it easier for newcomers to submit patches - even though you know it is not a clean solution. On the other hand, do you expect to receive high-quality contributions from developers who don't bother to properly configure their workstations?</p>
<h2 id="3-git-info-exclude">3. <code>.git\info\exclude</code></h2>
<p>For the sake of completeness, I must mention the third option. You can use <code>.git\info\exclude</code> file to exclude files for a single repository. But those exclusions are not versioned, so the others won't benefit from them.</p>
<p>I can't remember using it, but you may find it useful in some situations.</p>
<h2 id="conclusion">Conclusion</h2>
<p>Imagine that there is a new editor called Extra Textedit with an advanced AI which really helps with coding. As it becomes more popular, there will be a flood of commits and Pull Requests with <code>add .eedit directory to .gitconfig</code>.</p>
<p><strong>Please use the global .gitignore and don't make the people on the internet spend hundreds or thousands of hours on this.</strong></p>
<p>Btw. I recommend reading the <a href="https://git-scm.com/docs/gitignore">gitignore documentation</a> to learn more about the patterns you can use to exclude files.</p>
]]></content>
        </entry>
    
        <entry>
            <title type="html"><![CDATA[Oslo - co vidět? Kam na výlety?]]></title>
            <link href="https://blog.martinhujer.cz/oslo-kam-na-vylety/"/>
            <updated>2019-08-15T00:00:00.000Z</updated>
            <id>https://blog.martinhujer.cz/oslo-kam-na-vylety/</id>
            <content type="html"><![CDATA[<p>V červenci 2019 jsme byli týden v Oslu a stihli jsem toho spoustu, včetně dvou zajímavých hike za město, tak třeba se vám to bude hodit jako inspirace.</p>
<p><img src="/data/2019/2019-08-15-oslo-kam-na-vylety/ekebergparken-vyhled.jpg" alt="Výhled na Oslo z Ekebergparken" /></p>
<h2 id="cesta-do-osla">Cesta do Osla</h2>
<p>Letěli jsme z Prahy s Norwegian. Tím, že jsme byli docela omezení ve výběru termínu, tak nás nakonec zpáteční letenky (pro oba) stály 8700 Kč. Několik dnů po zabookování nám přišel mail, že zpáteční let ruší a že nás přehodili na jiný den. Pokud je to více než 14 dnů do odletu, tak to mohou klidně udělat. Ale v profilu pak šlo letenky zadarmo přebookovat na jiný termín, takže jsme zpáteční let přehodili na další den, na který ty lety předtím byly drahé. No a jako vždy jsme letěli jen s příručákem. Ani v Praze ani v Oslu velikost zavazadel neměřili.</p>
<h2 id="mhd-v-oslu">MHD v Oslu</h2>
<p>MHD v Oslu provozuje <a href="https://ruter.no/en/">Ruter As</a> a funguje to super. Na jízdenky se používá aplikace <a href="https://ruter.no/en/buying-tickets/sales-outlets/">RuterBillet</a>, kde si jízdenky přímo kupujete (existuje alternativa s nějakou plastovou kartičkou, to jsme nezkoumali). Koupili jsme si <a href="https://ruter.no/en/buying-tickets/tickets-and-fares/">týdenní jízdenky</a>. Výhoda je, že je můžete koupit dopředu a vybrat si čas začátku platnosti a případně je zapnout ručně. Kupodivu nefungovala platba kartou (MasterCard ani VISA, Airbank ani Fio), takže jsme platili PayPalem.</p>
<p>Většina Osla je v <a href="https://ruter.no/en/buying-tickets/zones/">zóně 1</a>, takže týdenní jízdenka nám stačila na tu jednu zónu. A na těch několik cest mimo si jde přes aplikaci přikoupit &quot;Extra&quot; na tu konkrétní zónu. Mají to hezky udělané, že místo toho, abyste museli zkoumat, jakou zónu chcete, jen vyberete, kam chcete jet a ono to ukáže, jakou zónu si máte koupit. Ty tickety na extra zónu jsou jen asi na hodinu až dvě, takže jde zase nastavit začátek platnosti a případně to těsně před nástupem do autobusu/lodi/vlaku odstartovat ručně.</p>
<p>Pro hledání spojů buď můžete používat Google Maps nebo jejich aplikaci RuterReise (ta ukazuje i zóny).</p>
<p>Většinu toho zvládnete linkami metra, které kromě centra jezdí po povrchu (historicky to bylo tak, že postupně zapojili samostatné tramvajové tratě do struktury metra).</p>
<h2 id="cesta-z-letiste">Cesta z letiště</h2>
<p>Z letiště je nejlepší <a href="https://avinor.no/en/airport/oslo-airport/to-and-from-the-airport/train-buss-and-taxi/trains">jet vlakem VY</a>. Pozor, na letišti mají mnohem lépe vidět prodej jízdenek do Airport Express Train (Flytoget), který stojí mnohem víc a není o moc rychlejší. Jízdenky na VY vlak si koupíte v automatu vlevo od toho Flytogetu. Nebo ještě lépe - pokud budete už mít dopředu koupenou jízdenku na MHD v RuterBillet, tak si jen přikoupíte zónu na letiště - je to levnější, než celá samostatná jízdenka.</p>
<p><img src="/data/2019/2019-08-15-oslo-kam-na-vylety/oslo-letiste.jpg" alt="Oslo - letiště" /></p>
<h2 id="penize-a-nakupovani">Peníze a nakupování</h2>
<p>V Norsku je docela draho, cca 2-3× než v ČR. Vzhledem k tomu, že kurz NOK je 2.7 CZK, tak se dá docela dobře orientovat podle cen, které mají kde napsané - jsou podobné jako v ČR, jen nesedí měna :-) (streetfood 110-150 NOK atd.)</p>
<p>Zajímavost: V Norsku fungují zálohy na PET láhve a plechovky, podobně jako v ČR na láhve od piva. (<a href="https://www.youtube.com/watch?v=lC4ymsm5llk">video</a>)</p>
<p>Všude se dá platit kartou. I když jsme došli lesem na takovou chatu, kde měli suché záchody, tak stejně měli terminál na karty. Stejně tak kiosek na ostrůvku u pláže. A veřejné záchodky v parku mají u dveří také terminál na pípnutí kartou. Takže jsme za celý týden neměli v ruce žádné norské peníze (ale nosili jsme nějaká eura, kdybychom s kartou náhodou někde neuspěli.)</p>
<p>Bydleli jsme na Airbnb, takže jsme si večeře vařili a k obědu jsme měli vždycky svačinu, protože jsme stejně byli někde na výletě. Suroviny v obchodě zas tak drahé nejsou (doporučuji supermarkety Kiwi nebo Rema 1000). A třeba takový chlazený losos stojí stejně jako v ČR ;-)</p>
<p>Když mluvím o bydlení, tak doporučuji bydlet na metru a max pár stanic od centra, ať ušetříte čas.</p>
<h2 id="elektroauta">Elektroauta</h2>
<p>V Norsku se prodává víc elektroaut než těch se spalovacím motorem. Je to hlavně kvůli různým úlevám pro EV a naopak ekologické dani z aut se spalovacím motorem (<a href="https://elbil.no/english/norwegian-ev-policy/">více info</a>). Vzhledem k tomu, že většinu elektřiny (95 %) získávají z vodních elektráren, to zní jako super nápad. Nevýhoda je, že rozvodná síť na to není připravena a <a href="https://www.reuters.com/article/us-norway-autos-electric-power/electric-vehicle-push-in-norway-could-add-1-3-billion-to-power-bills-by-2040-study-idUSKCN1T81Y0">budou do ní muset hodně investovat</a>.</p>
<p>A s tím souvisí jedna zajímavost - Ruter (dopravní podnik v Oslu) zkouší na jedné krátké lince <a href="https://ruter.no/en/about-ruter/reports-projects-plans/autonomous-vehicles/">provozovat autonomní elektrické minibusy</a>. To jsme samozřejmě museli vyzkoušet :-)</p>
<p><img src="/data/2019/2019-08-15-oslo-kam-na-vylety/autonomni-minibus.jpg" alt="Autonomní miniautobus" /></p>
<h2 id="drobak-a-oscarsborg-vylet-lodi">Drøbak a Oscarsborg - výlet lodí</h2>
<p>Drøbak je vesnice asi 30km od Osla, kam se dá dojet MHD lodí (pozor, je potřeba přikoupit zóny - viz výše). Když budete stát frontu na trajekt, tak vám bude připadat, že se tam nevejdete - ale ta loď je fakt velká (cca pro 200 lidí), tak se nebojte.</p>
<p><img src="/data/2019/2019-08-15-oslo-kam-na-vylety/drobak-lod.jpg" alt="Drøbak - cesta lodí" /></p>
<p>Lodí můžete dojet až do Drøbaku nebo vystoupit o zastávku dříve, na ostrově <a href="https://goo.gl/maps/RQd12k7vpRopjaV96">Oscarsborg</a>, kde je vojenská pevnost. Odtamtud se pak dá do Drøbaku dostat přívozem. Je to dost důležité místo norských dějin, protože v roce 1940 se jim z té pevnosti podařilo potopit německý křižník Blücher a tím zbrzdit invazi Němců do Osla tolik, že norský král a vláda stihl utéci. Doporučuji přečíst článek na Wikipedii: <a href="https://en.wikipedia.org/wiki/Battle_of_Dr%C3%B8bak_Sound">Battle of Drøbak Sound</a>. My jsme tam nebyli, protože jsem to zjistil až potom.</p>
<p><img src="/data/2019/2019-08-15-oslo-kam-na-vylety/drobak-oscarsborg.jpg" alt="Drøbak - Oscarsborg" /></p>
<p>V samotném Drøbaku je zajímavá třeba <a href="https://goo.gl/maps/tU6Mg9uEMUZArEdm8">pláž</a>, <a href="https://goo.gl/maps/YN91vLRMzCZepuzBA">Husvikbatteriet</a> - dělo, které se přičinilo o potopení křižníku Blücher. A kousek na kopci <a href="https://goo.gl/maps/XyfDrSeoGvHSWHms5">Veisvingbatteriet</a> - další děla, tentokrát v lepším stavu a se super výhledem na Oscarsborg.</p>
<p><img src="/data/2019/2019-08-15-oslo-kam-na-vylety/drobak-delo.jpg" alt="Drøbak - dělo" /></p>
<p>Zpátky z Drøbaku jsme už jeli autobusem, kterým to je rychlejší, než lodí.</p>
<h2 id="ostmarka-hike-16-km">Østmarka hike (16 km)</h2>
<p>Oslomarka je označení pro lesnatou a kopcovitou krajinu v okolí Osla, kterou Norové využívají k rekreaci (výlety, kola atd.). My jsme vyrazili do východní části nazvané Østmarka.</p>
<p><img src="/data/2019/2019-08-15-oslo-kam-na-vylety/ostmarka-1.jpg" alt="Østmarka - Svartputten" /></p>
<p><img src="/data/2019/2019-08-15-oslo-kam-na-vylety/ostmarka-2.jpg" alt="Østmarka" /></p>
<p>Metrem jsme dojeli na konečnou, do Ellingsrudåsen. Tam už kousek od východu z metra (který je vyražený ve skále!) začíná turistická trasa. Nejprve jsme šli kousek po hlavní turistické, která je zároveň cyklostezka, ale pak jsme odbočili směrem na Haukåsen. Většinou se nám podobné pokusy - třeba vylézt na nějaký vysoký kopec v okolí - odmění fajn zážitkem. Cestou jsme si udělali malinkou odbočku k jezeru Svartputten a pokračovali jsme se na Haukåsen. Ten je zajímavý zejména tím, že tam je umístěný radar.</p>
<p><img src="/data/2019/2019-08-15-oslo-kam-na-vylety/haukasen-radar.jpg" alt="Haukåsen radar" /></p>
<p>Odtamtud jsme došli na chatu Mariholtet, kde se dá občerstvit. Co nás hodně překvapilo bylo, že si místní nedávají pivo, ale kávu nebo colu. To by se v Čechách nestalo :-)</p>
<p>Dál jsme pokračovali po červené a pak po západní straně jezera Lutvann, odkud byl super výhled. Nakonec jsme došli na metro do Haugeurd a jeli domů.</p>
<p><img src="/data/2019/2019-08-15-oslo-kam-na-vylety/ostmarka-3.jpg" alt="Østmarka - Lutvann" /></p>
<p>Mrkněte na <a href="https://www.wikiloc.com/hiking-trails/oslo-ostmarka-hike-39504653">celou trasu na Wikiloc</a>.</p>
<p>Výhoda chození na výlety v Norsku v létě je, že vám díky pozdnímu soumraku nehrozí, že byste se do tmy nestihli vrátit.</p>
<h2 id="holmenkolen">Holmenkolen</h2>
<p>Holmenkollen je známý skokanský můstek, kde se konají různé důležité závody (nejen) ve skocích na lyžích. První můstek tam byl postaven koncem 19. století a zajímavé je, že ho jednou za čas zbourají a pak postaví nový a větší (naposledy v roce 2010).</p>
<p><img src="/data/2019/2019-08-15-oslo-kam-na-vylety/holmenkolen-1.jpg" alt="Holmenkolen" /></p>
<p>Metrem dojedete do stanice Holmenkollen a odtamtud dojdete kousek k můstku. Součástí areálu je muzeum, které popisuje historii samotného můstku, ale i polárních výprav. V ceně vstupenky je i výstup (resp. vyvezení se výtahem) na vršek můstku, odkud je super výhled. Doporučuji jít nejdříve vystát tu frontu na výtah, čím tam dorazíte později, tím je větší. Ale muzeum určitě nevynechejte (můžete si ho projít až po návratu z vyhlídky).</p>
<p>Kromě výhledu nabízí horní plošina možnost sjet si dolů na zipline - ale mě to teda přišlo dost vysoko :-) (na fotce jsou vidět ta ocelová lana)</p>
<p><img src="/data/2019/2019-08-15-oslo-kam-na-vylety/holmenkolen-2.jpg" alt="Holmenkolen" /></p>
<h2 id="hike-pres-vettakollen-a-ullevalseter-k-jezeru-sognsvann-15-km">Hike přes Vettakollen a Ullevålseter k jezeru Sognsvann (15 km)</h2>
<p>Z Holmenkollen jsme popojeli pár stanic na zastávku Vettakollen, odkud jsme vyrazili na další hike.</p>
<p>První část cesty je trochu do kopce, ale brzy přijde odměna v podobě super výhledu na Oslo (je to kupodivu dříve, než samotný vrchol Vettakollen - odtamtud není vidět nic).</p>
<p><img src="/data/2019/2019-08-15-oslo-kam-na-vylety/vettakollen-vyhled.jpg" alt="Vettakollen výhled" /></p>
<p>Pak pokračujete lesem, cestou občas potkáte nějaké jezero, jezírko nebo mokřad. Nejvzdálenějším bodem je Ullevålseter, což je taková horská chata, u které se potkávají různé turistické a cyklo trasy. I když to je uprostřed ničeho, tak samozřejmě jde platit kartou. A pozor, <a href="http://www.ullevalseter.no/aapningstider.htm">podle webu</a> mají v pondělí zavřeno, tak ať vás to nepřekvapí. Dali jsme si tak ke svačině kávu, horkou čokoládu a něco sladkého.</p>
<p><img src="/data/2019/2019-08-15-oslo-kam-na-vylety/ullevalseter-chata.jpg" alt="Chata Ullevålseter" /></p>
<p><img src="/data/2019/2019-08-15-oslo-kam-na-vylety/jezero-lille-aklungen.jpg" alt="Jezero Lille Aklungen" /></p>
<p>Cestou zpět jsme šli kolem dvou velkých jezer, a nakonec jsme došli k jezeru Sognsvann. To je kousek od města, takže tam spoustu místních chodí běhat.</p>
<p><a href="https://www.wikiloc.com/hiking-trails/oslo-hike-over-vettakollen-and-ullevalseter-to-sognsvann-lake-15-km-39523547">Celá trasa opět na Wikiloc</a>.</p>
<p><img src="/data/2019/2019-08-15-oslo-kam-na-vylety/sognsvann.jpg" alt="Jezero Sognsvann" /></p>
<h2 id="grilovani-jednorazove-grily">Grilování, jednorázové grily</h2>
<p>Možná to bylo tím, že jsme v Oslu měli dobré počasí, ale mezi místními je hodně populární grilování na jednorázových grilech (takové ten alobalový tácek naplněný uhlím). Grilují všude možně, třeba právě u toho jezera Sognsvann.</p>
<p>Hodně zajímavé je, že tomu museli přizpůsobit infrastrukturu. Na místech, která se hodí na grilování, mají kromě obyčejných košů také speciální kovový koš na vyhazování těch jednorázových grilů!</p>
<p><img src="/data/2019/2019-08-15-oslo-kam-na-vylety/kos-na-grily.jpg" alt="Koš na grily" /></p>
<h2 id="kava">Káva</h2>
<p>Na kávu jsme nikam moc nechodili, takže mám jen jeden tip na kavárnu - <a href="https://goo.gl/maps/zNZTYwbPTbzFSmfY9">Espresso House</a>.</p>
<p>Na Airbnb byl Nespresso kávovar, takže jsme si kávu vařili doma. S tím souvisí zajímavost - jak jsem psal výše, tak všechno je v Norsku 2-3× dražší, ale Nespresso kapsle stojí v přepočtu <a href="https://www.nespresso.com/no/no/order/capsules/original">stejně jako v ČR</a> (NOK 3,89 vs CZK 9,90). Pro kapsle jsme se stavili v <a href="https://goo.gl/maps/yaPmP2t7qp8Q7HCa7">Nespresso obchodě</a> na jejich &quot;Pařížské&quot;.</p>
<h2 id="oslo-ostrovy-langoyene-a-gressholmen">Oslo - ostrovy Langøyene a Gressholmen</h2>
<p>Kromě delší cesty lodí do Drøbaku, o které jsem psal výše, můžete v Oslu vyrazit MHD lodí na ostrovy, které jsou kousek za městem (a zase platí, že ta loď vypadá malá, ale vejde se tam spoustu lidí, takže nezůstanete na břehu ani když tam bude velká fronta).</p>
<p>My jsme nejdříve vyrazili na <a href="https://goo.gl/maps/zYZP7bWyFVTBbB188">Langøyene</a>, kde je fajn pláž. Kromě toho to je jediný z ostrovů, na kterém se může stanovat. Kousek od pláže je kiosek, který samozřejmě přijímá platební karty.</p>
<p>Odtamtud jsme přejeli na ostrov <a href="https://goo.gl/maps/Dt8oKX5tBAv7zvph7">Gressholmen</a>. Ten je mnohem více zarostlý, ale taky je na něm několik pláží. A zajímavostí je, že na něm kdysi bylo <a href="https://en.wikipedia.org/wiki/Gressholmen_Airport">první norské letiště</a> (pro hydroplány).</p>
<h1 id="oslo">Oslo</h1>
<p>A teď zajímavé věci v samotném Oslu.</p>
<h2 id="ekebergparken">Ekebergparken</h2>
<p><a href="https://goo.gl/maps/7w8F6s5FHmffBW747">Ekebergparken</a> je kopec s parkem na kraji Osla. Nejlepší je dojet tramvají přímo do zastávky Ekebergparken a odtamtud se projít po parku, prohlédnout si sochy a dojít na vyhlídku, odkud je vidět kontrast starých a nových budov v Oslu. Odtamtud se pak dá po cestičce sejít dolů do centra.</p>
<p><img src="/data/2019/2019-08-15-oslo-kam-na-vylety/ekebergparken-socha.jpg" alt="Sochy v Ekebergparken" /></p>
<h2 id="opera">Opera</h2>
<p><a href="https://goo.gl/maps/GFm8c3mREkXXQ3HR9">Operahuset</a> je zajímavé zejména tím, že je možné vyjít až na střechu, odkud je fajn výhled.</p>
<p><img src="/data/2019/2019-08-15-oslo-kam-na-vylety/opera.jpg" alt="Oslo - Operahuset" /></p>
<h2 id="pevnost-akershus">Pevnost Akershus</h2>
<p>Určitě doporučuji nevynechat <a href="https://goo.gl/maps/Ly5w78xJGUgTa3Q16">pevnost Akershus</a> - kromě historických budov je odtamtud hezký výhled na přístav.</p>
<p><img src="/data/2019/2019-08-15-oslo-kam-na-vylety/akershus.jpg" alt="Akershus" /></p>
<p><img src="/data/2019/2019-08-15-oslo-kam-na-vylety/akershus-vyhled-na-pristav.jpg" alt="Akershus - výhled na přístav" /></p>
<h2 id="norsk-folkemuseum">Norsk Folkemuseum</h2>
<p>Do <a href="https://goo.gl/maps/v16qykDyT12SHLXa8">Norsk Folkemuseum</a> postupně přemístili různé budovy, aby mohli ukázat, jak v minulosti žili lidé (nejen) na norském venkově. Areál si buď můžete projít sami nebo se připojit k některé z komentovaných prohlídek (doporučuji!). Nejvýznamnější památkou v muzeu je <a href="https://norskfolkemuseum.no/en/stave-church">kostel přibližně z roku 1200</a>, který koncem 19. století nechal král přestěhovat tam, kde je teď.</p>
<p><img src="/data/2019/2019-08-15-oslo-kam-na-vylety/skanzen-kostel.jpg" alt="Norsk Folkemuseum - kostel" /></p>
<p>A jedna zajímavost, kterou jsme se tam dozvěděli. Určitě znáte takové ty domky se střechami porostlými trávou (a teď nemyslím moderní kancelářské budovy). Vždycky jsem myslel, že ta tráva tam má nějaký účel, ale ono ne. Jen holt tenkrát dávali na střechu vrstvu hlíny jako izolaci a shodou okolností z ní pak rostla tráva.</p>
<p><img src="/data/2019/2019-08-15-oslo-kam-na-vylety/skanzen-trava-na-strese.jpg" alt="Norsk Folkemuseum - tráva na střeše" /></p>
<h2 id="playa-de-huk">Playa de Huk</h2>
<p>Když už kvůli Folkemuseum (nebo jinému muzeu) budete na poloostrově Bygdøy, tak si vezměte plavky a běžte se vykoupat na <a href="https://goo.gl/maps/h4aWDmCRXhmJHyhh6">Playa de Huk</a>. My jsme měli štěstí na počasí - bylo 28°C, takže pláž byla narvaná :-)</p>
<h2 id="kralovsky-palac-a-zahrada">Královský palác a zahrada</h2>
<p>Když už budete v Oslu, tak se určitě zajděte podívat na <a href="https://goo.gl/maps/ipKQj5Lks4JADDfVA">královský palác</a> a do jeho zahrad.</p>
<p><img src="/data/2019/2019-08-15-oslo-kam-na-vylety/kralovsky-palac.jpg" alt="Královský palác" /></p>
<p><img src="/data/2019/2019-08-15-oslo-kam-na-vylety/kralovsky-palac-zahrada.jpg" alt="Královský palác - zahrada" /></p>
<h2 id="frognerparken">Frognerparken</h2>
<p><a href="https://goo.gl/maps/rAY3rrrUpDQu4T7w5">Velký park</a>, jedno z více turistických míst. Zejména kvůli zajímavé fontáně obklopené turisty a sloupovému sousoší.</p>
<p><img src="/data/2019/2019-08-15-oslo-kam-na-vylety/frognerparken-fontana.jpg" alt="Frognerparken - fontána" /></p>
<p><img src="/data/2019/2019-08-15-oslo-kam-na-vylety/frognerparken-sousosi.jpg" alt="Frognerparken - sousoší" /></p>
<h1 id="zaverem">Závěrem</h1>
<p>V Oslu a jeho okolí toho je spoustu k vidění. Určitě doporučuji zařadit nějaké výlety za město než jen chodit mezi budovami.</p>
]]></content>
        </entry>
    
</feed>
