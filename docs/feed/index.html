<?xml version="1.0" encoding="utf-8" ?>
<feed xmlns="http://www.w3.org/2005/Atom">
    <title><![CDATA[Martin Hujer blog]]></title>
    <link href="https://blog.martinhujer.cz/feed/" rel="self"/>
    <link href="https://blog.martinhujer.cz/"/>
    <updated>2018-01-08T09:35:49+00:00</updated>
    <id>https://blog.martinhujer.cz/</id>
            <author>
            <name><![CDATA[Martin Hujer]]></name>                    </author>
        <generator uri="http://sculpin.io/">Sculpin</generator>
            <entry>
            <title type="html"><![CDATA[17 Tips for Using Composer Efficiently]]></title>
            <link href="https://blog.martinhujer.cz/17-tips-for-using-composer-efficiently/"/>
            <updated>2018-01-05T00:00:00+00:00</updated>
            <id>https://blog.martinhujer.cz/17-tips-for-using-composer-efficiently/</id>
            <content type="html"><![CDATA[<p>Although most PHP developers know how to use Composer, not all of them are using it efficiently or in a best possible way. So I decided to summarize things which are important for my everyday workflow.</p>

<p>The philosophy of most of the tips is <em>"Play it safe"</em>, which means that if there are more ways how to handle something, I would use the approach which is least error-prone.</p>

<h2 id="tip-%231%3A-read-the-documentation">Tip #1: Read the documentation</h2>

<p>I really mean it. <a href="https://getcomposer.org/doc/">The documentation</a> is great and a few hours of reading it will save you more time in the long run. You would be surprised how many things Composer can do.</p>

<h2 id="tip-%232%3A-be-aware-of-differences-between-a-%22project%22-and-a-%22library%22">Tip #2: Be aware of differences between a "project" and a "library"</h2>

<p>It's important to know, whether you are creating a <em>"project"</em> or a <em>"library"</em>. Each of them requires separate set of practices.</p>

<p>A library is a reusable package, that you would add as a dependency - such as <code>symfony/symfony</code>, <code>doctrine/orm</code> or <a href="https://github.com/elastic/elasticsearch-php"><code>elasticsearch/elasticsearch</code></a>.</p>

<p>A project is typically an application, that depends on several libraries. It is usually not reusable (no other projects would require it as a dependency). Typical example is an ecommerce website, customer support system etc.</p>

<p>I will distinguish between library and a project in the tips bellow.</p>

<h2 id="tip-%233%3A-use-specific-dependencies%27-versions-for-applications">Tip #3: Use specific dependencies' versions for applications</h2>

<p>If you are creating an application, you should use the most specific version to define the dependency. If you need to parse YAML files, you should specify the dependency like this <code>"symfony/yaml": "4.0.2"</code>.</p>

<p>Even if the library follows <a href="https://semver.org/">Semantic Versioning</a>, there may be backwards-compatibility breaks in the minor and patch versions. For example, if you are using <code>"symfony/symfony": "^3.1"</code>, there may be something deprecated in 3.2 which may break your application tests. Or there may be a bug fixed in PHP_CodeSniffer and it would detect new formatting issues in your code, which again may lead to a broken build.</p>

<p>The update of dependencies should be deliberate, not accidental. One of the tips bellow discusses it in greater detail.</p>

<p>It may sound as an overkill, but it will prevent your co-workers from accidentally updating all dependencies when adding a new library to project (which you may miss during Code Review).</p>

<h2 id="tip-%234%3A-use-version-ranges-for-libraries-dependencies">Tip #4: Use version ranges for libraries dependencies</h2>

<p>If you are creating a library, you should define the broadest version range possible. If you create a library that uses <code>symfony/yaml</code> library for YAML parsing, you should require it like this:</p>

<pre><code class="json">"symfony/yaml": "^3.0 || ^4.0"
</code></pre>

<p>It means that your library can utilize <code>symfony/yaml</code> from any Symfony 3.x or 4.x versions. It is important, because this constraint is passed to the application that uses your library.</p>

<p>In case there are two libraries with conflicting requirements, e.g. one requires <code>~3.1.0</code> and other requires <code>~3.2.0</code>, the installation would fail.</p>

<h2 id="tip-%235%3A-you-should-commit-%60composer.lock%60-to-git-in-applications">Tip #5: You should commit <code>composer.lock</code> to git in applications</h2>

<p>If you are creating <em>a project</em>, you definitely want to commit <code>composer.lock</code> to git. This ensures that everyone - you, your co-workers, your CI server and your production server - is running the application with the same dependencies versions.</p>

<p>At first glance, it may sound superfluous - you are already using a specific version in the constraint, as mentioned in the tip #3. But no, there are also the dependencies of your dependencies which are not bound by these constraints (e.g. <code>symfony/console</code> depends on <code>symfony/polyfill-mbstring</code>). So without committing the <code>composer.lock</code>, you won't get the exact same set of dependencies.</p>

<h2 id="tip-%236%3A-put-%60composer.lock%60-into-%60.gitignore%60-in-libraries">Tip #6: Put <code>composer.lock</code> into <code>.gitignore</code> in libraries</h2>

<p>If you are creating <em>a library</em> (let's call it <code>acme/my-library</code>), you should not commit a <code>composer.lock</code> file. It <a href="https://getcomposer.org/doc/02-libraries.md#lock-file">does not have any effect</a> on the projects that are using your library.</p>

<p>Imagine that the <code>acme/my-library</code> uses <code>monolog/monolog</code> as a dependency. If you have committed a <code>composer.lock</code>, everyone who is developing the <code>acme/my-library</code> would be using an older version of Monolog. But when the library is finished, and you use it in a real project, a newer version of Monolog may be installed, and it may not be compatible with the library. But you didn't notice it before, because of the <code>composer.lock</code>!</p>

<p>It is best to put <code>composer.lock</code> into your <code>.gitignore</code> so you won't commit it accidentally.</p>

<p>If you want to make sure that the library is compatible with different versions of its dependencies, read the next tip!</p>

<h2 id="tip-%237%3A-run-travis-ci-builds-with-different-versions-of-dependencies">Tip #7: Run Travis CI builds with different versions of dependencies</h2>

<blockquote>
  <p>This tip applies only to libraries (because you use specific versions for applications).</p>
</blockquote>

<p>If you are building an open-source library, you are probably using Travis CI for running its builds.</p>

<p>By default, Composer installs the latest possible versions of dependencies which are allowed by the constraints in <code>composer.json</code>. It means that for the dependency constraint <code>^3.0 || ^4.0</code>, the build would always use the latest version of the v4 release. As the 3.0 is never tested, the library may not be compatible with it and that would make your users sad.</p>

<p>Luckily, Composer provides a switch to install the lowest possible versions of dependencies <code>--prefer-lowest</code> (should be used with <code>--prefer-stable</code> to prevent installation of non-stable versions).</p>

<p>Updated <code>.travis.yml</code> configuration may look like this:</p>

<pre><code class="yaml">language: php

php:
  - 7.1
  - 7.2

env:
  matrix:
    - PREFER_LOWEST="--prefer-lowest --prefer-stable"
    - PREFER_LOWEST=""

before_script:
  - composer update $PREFER_LOWEST

script:
  - composer ci
</code></pre>

<p>See it live in <a href="https://github.com/mhujer/fio-api-php/blob/master/.travis.yml">my mhujer/fio-api-php library</a> and <a href="https://travis-ci.org/mhujer/fio-api-php">the build matrix on Travis CI</a></p>

<p>Even though this solution would catch most of the incompatibilities, remember that there are many combinations of dependencies between lowest and latest versions. And they may be incompatible together.</p>

<h2 id="tip-%238%3A-sort-packages-in-require-and-require-dev-by-name">Tip #8: Sort packages in require and require-dev by name</h2>

<p>It is a good practice to keep packages in <code>require</code> and <code>require-dev</code> sorted by name. It can prevent unnecessary merge conflicts when rebasing a branch. Because if you have added a package to the end of the list in two branches, there would be a merge conflict every time.</p>

<p>It is a tedious task to do manually, so it is best to <a href="https://getcomposer.org/doc/06-config.md#sort-packages">configure it</a> in <code>composer.json</code>:</p>

<pre><code class="json">{
...
    "config": {
        "sort-packages": true
    },
…
}
</code></pre>

<p>Next time, you <code>require</code> a new package, it will be added to a proper place (and not to the end).</p>

<h2 id="tip-%239%3A-do-not-attempt-to-merge-%60composer.lock%60-when-rebasing-or-merging">Tip #9: Do not attempt to merge <code>composer.lock</code> when rebasing or merging</h2>

<p>If you add a new dependency to <code>composer.json</code> (and <code>composer.lock</code>) and before your branch is merged, there is another dependency added in master, you need to rebase your branch. And you will get a merge-conflict in <code>composer.lock</code>.</p>

<p>You should never try to resolve this conflict manually, because the <code>composer.lock</code> file contains a hash of dependencies defined in <code>composer.json</code>. So even if you resolve the conflict, the resulting lock file would be incorrect.</p>

<p>Best thing to do is to create <code>.gitattributes</code> in the project root with the following line, which means that the git won't even attempt to merge the <code>composer.lock</code>:</p>

<pre><code class="ini">/composer.lock -merge
</code></pre>

<p>You can remedy this issue by using short-lived feature branches as suggested in <a href="https://trunkbaseddevelopment.com/">Trunk Based Development</a> (you should be doing this anyway). When you have a short-lived branch, which is merged promptly, the risk of merge conflict in <code>composer.lock</code> is minimal. You may even create a branch just for adding a dependency and merge it right away.</p>

<p>But what to do, if you encounter a merge conflict in <code>composer.lock</code> when rebasing? Resolve it with the version from master, so you will have changes only in <code>composer.json</code> (the newly added package). And then run <code>composer update --lock</code>, which will to update the <code>composer.lock</code> file with changes from <code>composer.json</code>. Now you can stage the updated  <code>composer.lock</code> and continue with the rebase.</p>

<h2 id="tip-%2310%3A-know-the-difference-between-%60require%60-and-%60require-dev%60">Tip #10: Know the difference between <code>require</code> and <code>require-dev</code></h2>

<p>It is important to be aware of the difference between <code>require</code> and <code>require-dev</code> blocks.</p>

<p>Packages which are required to run the application or library should be defined in <code>require</code> (e.g. Symfony, Doctrine, Twig, Guzzle, …). If you are creating a library, be careful about what you put to <code>require</code>. Because each dependency from this section is also a dependency of the application, which uses the library.</p>

<p>Packages necessary for developing the application (or library) should be defined in <code>require-dev</code> (e.g. PHPUnit, PHP_CodeSniffer, PHPStan).</p>

<h2 id="tip-%2311%3A-update-dependencies-safely">Tip #11: Update dependencies safely</h2>

<p>I guess we can agree on the fact that dependencies should be updated regularly. What I want to discuss here is that dependencies updating should be explicit and deliberate, not done just by-the-way with some other work. If you refactor something and at the same time update some library, you can't easily tell if the app was broken by the refactoring or by the update.</p>

<p>You can use <code>composer outdated</code> command to see what dependencies can be updated. It is a good idea to include <code>--direct</code> (or <code>-D</code>) switch to list only dependencies specified in <code>composer.json</code>. There is also a <code>-m</code> switch to list only minor version updates.</p>

<p><strong>For each outdated dependency follow these steps</strong>:</p>

<ol>
<li>Create a new branch</li>
<li>Update the dependency version in <code>composer.json</code> to the latest one</li>
<li>Run <code>composer update phpunit/phpunit --with-dependencies</code> (replace <code>phpunit/phpunit</code> with the library you are updating)</li>
<li>Check the CHANGELOG in the library repository on Github to see if there are any breaking changes. If so, update the application</li>
<li>Test the application locally (If you are using Symfony, you can find deprecation warnings in the Debug Bar)</li>
<li>Commit the changes (<code>composer.json</code>, <code>composer.lock</code> and anything else what was necessary for new version to work)</li>
<li>Wait for the CI build to finish</li>
<li>Merge and deploy</li>
</ol>

<p>Sometimes it makes sense to update more dependencies at once, e.g. when you are updating Doctrine or Symfony. In this case you can list them all in update command:</p>

<pre><code class="bash">composer update symfony/symfony symfony/monolog-bundle --with-dependencies
</code></pre>

<p>Or you can use a wildcard to update all dependencies from a specific namespace:</p>

<pre><code class="bash">composer update symfony/* --with-dependencies
</code></pre>

<p>I know that this all sounds tedious, but you will probably update dependencies just occasionally, so it is worth the extra safety.</p>

<p>One shortcut which is acceptable to make is to update all <code>require-dev</code> dependencies at once (if they do not require changes in the code, otherwise I would suggest using separate branches for easier code review).</p>

<h2 id="tip-%2312%3A-you-can-define-other-types-of-dependencies-in-%60composer.json%60">Tip #12: You can define other types of dependencies in <code>composer.json</code></h2>

<p>Apart from defining libraries as dependencies, you can also define other things there.</p>

<p>You can define, which PHP versions your application/library supports:</p>

<pre><code class="json">"require": {
    "php": "7.1.* || 7.2.*",
},
</code></pre>

<p>You can also define which extensions are required for the application/library. It is super-useful when you are trying to dockerize your application or your new colleague is setting-up the application for the first time.</p>

<pre><code class="json">"require": {
    "ext-mbstring": "*",
    "ext-pdo_mysql": "*",
},
</code></pre>

<p>(You should use <code>*</code> for the extensions version as <a href="https://getcomposer.org/doc/01-basic-usage.md#platform-packages">they may be a bit inconsistent</a>).</p>

<h2 id="tip-%2313%3A-validate-the-%60composer.json%60-during-the-ci-build">Tip #13: Validate the <code>composer.json</code> during the CI build</h2>

<p><code>composer.json</code> and <code>composer.lock</code> should be always kept in sync. Therefore, it is a good idea to have an automatic check for it. Just add this as a part of you build script and it will ensure that <code>composer.lock</code> is in sync with <code>composer.json</code>:</p>

<pre><code class="bash">composer validate --no-check-all --strict
</code></pre>

<h2 id="tip-%2314%3A-use-a-composer-plugin-in-phpstorm">Tip #14: Use a Composer plugin in PHPStorm</h2>

<p>There is a <a href="https://plugins.jetbrains.com/plugin/7631-php-composer-json-support">composer.json plugin for PHPStorm</a>. It adds autocompletion and some validations when changing <code>composer.json</code> manually.</p>

<p>If you are using other IDE (or just a code editor), you can setup validation against <a href="https://getcomposer.org/schema.json">its JSON schema</a>.</p>

<h2 id="tip-%2315%3A-specify-the-production-php-version-in-%60composer.json%60">Tip #15: Specify the production PHP version in <code>composer.json</code></h2>

<p>If you are like me and you are sometimes <a href="https://blog.martinhujer.cz/php-7-2-is-due-in-november-whats-new/">running pre-released PHP versions locally</a>, you are in risk of updating the dependencies to a version that won't work in production. Right now, I'm using PHP 7.2.0 which means, that I can install libraries, that would not work on 7.1. As the production is running 7.1, the installation would fail there.</p>

<p>But no need to worry, there is an easy way out. Just specify the production PHP version in <code>config</code> section of <code>composer.json</code>:</p>

<pre><code class="json">"config": {
    "platform": {
        "php": "7.1"
    }
}
</code></pre>

<p>Don't confuse it with <code>require</code> section, which behaves differently. Your application may be able to run on 7.1 or 7.2 and at the same time specify 7.1 as a platform (which means that the dependencies will be always updated to a version compatible with 7.1):</p>

<pre><code class="json">"require": {
    "php": "7.1.* || 7.2.*"
},
"config": {
    "platform": {
        "php": "7.1"
    }
},
</code></pre>

<h2 id="tip-%2316%3A-using-private-packages-from-self-hosted-gitlab">Tip #16: Using private packages from self-hosted Gitlab</h2>

<p>It is recommended to use <code>vcs</code> as a repository type and the Composer should determine the proper way of fetching the packages. For example, if you are adding a fork from Github, it would use its API to download the .zip file instead of cloning the whole repository.</p>

<p>But it is more complicated for a private Gitlab installation. If you use <code>vcs</code> as a repository type, Composer will detect that it is a Gitlab installation would try to download the package using the API (which requires an API key. I didn't want to set it up, so I settled for this setup (which uses SSH for cloning):</p>

<p>First specify the repository with the type <code>git</code>:</p>

<pre><code class="json">"repositories": [
    {
        "type": "git",
        "url": "git@gitlab.mycompany.cz:package-namespace/package-name.git"
    }
]
</code></pre>

<p>Then use the package as you would have normally:</p>

<pre><code class="json">"require": {
    "package-namespace/package-name": "1.0.0"
}
</code></pre>

<h2 id="tip-%2317%3A-how-to-temporarily-use-a-branch-with-bugfix-from-fork">Tip #17: How to temporarily use a branch with bugfix from fork</h2>

<p>If you find a bug in some public library and you fix it in your fork on Github, you need to install the library from this repository instead of the official one (until the bugfix is merged and fixed version is released).</p>

<p>It can be done easily with <a href="https://getcomposer.org/doc/articles/aliases.md#require-inline-alias">inline aliasing</a>:</p>

<pre><code class="json">{
    "repositories": [
        {
            "type": "vcs",
            "url": "https://github.com/you/monolog"
        }
    ],
    "require": {
        "symfony/monolog-bundle": "2.0",
        "monolog/monolog": "dev-bugfix as 1.0.x-dev"
    }
}
</code></pre>

<p>You can test the bugfix locally before pushing it by <a href="https://getcomposer.org/doc/05-repositories.md#path">using <code>path</code> as a repository type</a>.</p>

<h2 id="update-2018-01-08%3A">Update 2018-01-08:</h2>

<p>After publishing the article, I got suggestions for several more tips. So here they are:</p>

<h2 id="tip-%2318%3A-install-prestissimo-to-speed-up-package-installation">Tip #18: Install prestissimo to speed up package installation</h2>

<p>There is a Composer plugin <a href="https://github.com/hirak/prestissimo">hirak/prestissimo</a> which speeds up dependencies installation by downloading them in parallel.</p>

<p>And the best thing? You only need to install it once, globally and it will work automatically for all projects:</p>

<pre><code class="bash">composer global require hirak/prestissimo
</code></pre>

<h2 id="tip-%2319%3A-test-your-version-constraints-if-you-are-not-sure">Tip #19: Test your version constraints if you are not sure</h2>

<p>Writing correct version constraints may sometimes be tricky even after reading <a href="https://getcomposer.org/doc/articles/versions.md#writing-version-constraints">the documentation</a>.</p>

<p>Luckily, there is a <a href="https://semver.mwl.be/">Packagist Semver Checker</a> where you can check which versions match the specified constraint. Instead of only analysing the version constraint, it downloads the data from Packagist to display the actual released versions.</p>

<p>See <a href="https://semver.mwl.be/#?package=symfony%2Fsymfony&amp;version=%5E3.1&amp;minimum-stability=stable">the result for <code>symfony/symfony:^3.1</code></a>.</p>

<h2 id="tip-%2320%3A-use-authoritative-class-map-in-production">Tip #20: Use authoritative class map in production</h2>

<p>You should <a href="https://getcomposer.org/doc/articles/autoloader-optimization.md#optimization-level-2-a-authoritative-class-maps">generate authoritative class map</a> in production. It will speed-up class loading by including everything in class-map and skipping any filesystem checks.</p>

<p>You can do it by running this as a part of your production build:</p>

<pre><code class="bash">composer dump-autoload --classmap-authoritative
</code></pre>

<h2 id="tip-%2321%3A-configure-%60autoload-dev%60-for-tests">Tip #21: Configure <code>autoload-dev</code> for tests</h2>

<p>You don't want to include test files in production class map (because of the file size and memory). It can be done by configuring the <code>autoload-dev</code> (similarly to <code>autoload</code>):</p>

<pre><code class="json">"autoload": {
    "psr-4": {
        "Acme\\": "src/"
    }
},
"autoload-dev": {
    "psr-4": {
        "Acme\\": "tests/"
    }
},
</code></pre>

<h2 id="conclusion">Conclusion</h2>

<p>If you disagree with some of the tips, I would be happy if you can describe why in the comments (don't forget to put the tip number there).</p>
]]></content>
        </entry>
            <entry>
            <title type="html"><![CDATA[Madrid - co navštívit?]]></title>
            <link href="https://blog.martinhujer.cz/madrid/"/>
            <updated>2017-11-25T00:00:00+00:00</updated>
            <id>https://blog.martinhujer.cz/madrid/</id>
            <content type="html"><![CDATA[<p>S Ivčou jsme strávili jeden listopadový týden v Madridu. Centrum jsme prochodili křížem krážem a tady bych chtěl shrnout zajímavosti, které byste určitě neměli minout (a nebo naopak měli).</p>

<p><img src="/data/2017/2017-11-25-madrid/madrid-palacio.jpg" alt="Palacio Real de Madrid" /></p>

<h2 id="bydlen%E3%AD">Bydlení</h2>

<p>Bydleli jsme vedle parku <a href="https://goo.gl/maps/vg7atmVqA5B2">El Retiro</a>, takže to do centra byl kousíček.</p>

<h2 id="co-nav%E5%A1t%E3%ADvit">Co navštívit</h2>

<p>(seznam není nijak seřazený)</p>

<p>Ve všední dny mají některá muzea a galerie navečer vstup zdarma (doporučuji čas vždycky ověřit na jejich webu).</p>

<ul>
<li><p><strong><a href="https://goo.gl/maps/B59SSdNbeQp">Parque de El Retiro</a></strong> - obrovský park v centru města. Najdete v něm i růžovou zahradu nebo pávy.</p></li>
<li><p><strong><a href="https://goo.gl/maps/Z1wSFxsyGGF2">Estanque grande del Retiro</a></strong> - ještě chvíli zůstaneme v El Retiro, protože v něm je taky jezírko, kde si jde půjčit lodičku (Myslím, že za 6€). Pokud bude hezké počasí, tak to určitě stojí za to. A doporučuji všední den, o víkendu tam byla dost fronta.</p></li>
<li><p><strong><a href="https://goo.gl/maps/DXA85mp5pr72">Atocha Cercanías</a></strong> - vlakové nádraží, které uvnitř obsahuje botanickou zahradu. Včetně jezírka se spoustou želviček.</p></li>
<li><p><strong><a href="https://goo.gl/maps/E5NRAAY5vr62">Real Jardín Botánico</a></strong> - botanická zahrada, kde toho bylo dost k vidění i v listopadu. Mají tam výstavku bonsají. A super skleníky. Vstup 4€.</p></li>
<li><p><strong><a href="https://goo.gl/maps/vaNcEfiKV532">Casa Museo Lope de Vega</a></strong> - muzeum Lope de Vega, mají prohlídku zdarma, ale je potřeba se <a href="http://www.casamuseolopedevega.org/es/actividades/visitas-guiadas">dopředu objednat e-mailem</a>. A prohlídky umí i v angličtině ;-)</p></li>
<li><p><strong><a href="https://goo.gl/maps/j6n8YJpEPS62">El Rastro</a></strong> - trh každou neděli dopoledne. Původně to prý byl blešák, ale mně to přišlo spíš jako obyčejná tržnice.</p></li>
<li><p><strong><a href="https://goo.gl/maps/4WMSBgbqwCS2">Chocolatería San Ginés</a></strong> - prodávají churros už od roku 1894. Zajímavostí je, že mají otevřeno 24 hodin denně. Ať vás nepřekvapí, že v rámci efektivity se neobjednává u stolu, ale nejdříve vystojíte frontu a objednáte si u baru. Teprve pak si sednete a nějaký číšník si od vás vezme lísteček s objednávkou.</p>

<p><img src="/data/2017/2017-11-25-madrid/churros.jpg" alt="Churros" /></p></li>
<li><p><strong><a href="https://goo.gl/maps/ZS5Huqk37n42">Mercado de San Miguel</a></strong> - street food market s různými tradičními španělskými jídly (různé rybí pochoutky, croquetas, jamón, olivy, apod.). Nás víc bavil <a href="https://goo.gl/maps/edsstngGqc52">Mercado San Anton</a>, kde bylo méně lidí.</p></li>
<li><p><strong><a href="https://goo.gl/maps/MmxDmnYupXU2">Museo Nacional del Prado</a></strong> - do Prada jsme nakonec vůbec nešli, protože nás obrazy moc nebaví. Ke konci dne mají vstup zdarma a to tam je prý dost narváno.</p></li>
<li><p><strong><a href="https://goo.gl/maps/Hms9xkFdpSN2">Museo Naval de Madrid</a></strong> - muzeum španělského námořnictví. A že mají co ukazovat! Bylo to parádní a vstupné jen 3€.</p></li>
<li><p><strong><a href="https://goo.gl/maps/nfgyYRWX8AJ2">Museo de Historia de Madrid</a></strong> - muzeum historie Madridu. Vstup zdarma. A popisky i v angličtině.</p></li>
<li><p><strong><a href="https://goo.gl/maps/kvFYdGSUcmt">Teleférico de Madrid</a></strong> - městská lanovka, odveze vás do Caso de Campo. Byla tam docela fronta, ale zážitek pěkný.</p></li>
<li><p><strong><a href="https://goo.gl/maps/JQwExGNuugA2">Caso de Campo</a></strong> - sem vás doveze lanovka. Je to obrovský park nebo možná spíš "les". Místní tam jezdí na pikniky. Zpátky můžete zas jet lanovou nebo klidně dojít pěšky.</p></li>
<li><p><strong><a href="https://goo.gl/maps/hwBYb1gXY1A2">Primark</a></strong> - čtyřpatrový Primark je epic. Ale nakonec jsme nic nekoupili, protože tam bylo hrozně moc lidí a dlouhé fronty na kabinky.</p></li>
<li><p><strong><a href="https://goo.gl/maps/QCwDVE6bhk22">Catedral de la Almudena</a></strong> - hezká katedrála</p></li>
<li><p><strong><a href="https://goo.gl/maps/8ksaSVjckG92">Campo del Moro</a></strong> - velký park za královským palácem. Pozor, má to <a href="https://goo.gl/maps/n8DzGUtjfDt">jen jeden vstup</a>.</p></li>
<li><p><strong><a href="https://goo.gl/maps/7aKv7Nm4rrJ2">CentroCentro</a></strong> - kulturní centrum. Mají tam nějaké haluzné výstavy a něco jako coworking (wifi, stoly, zásuvky). A hlavně se za 2€ dá jít na vyhlídkovou věž.</p></li>
<li><p><strong><a href="https://goo.gl/maps/ryRtvP1QioN2">Madrid Río</a></strong> - obrovský park podél řeky. Kromě jiného v něm mají i skluzavky a houpačky pro dospělé!</p></li>
<li><p><strong><a href="https://goo.gl/maps/gBEg4dXZs1G2">Matadero Madrid</a></strong> - původně jatka, udělali z toho kulturní centrum. Zajímavá architektura.</p></li>
<li><p><strong><a href="https://goo.gl/maps/JD3xQQ69PGy">Templo de Debod</a></strong> - starý egyptský chrám, je o něj pěkný výhled na západ slunce</p>

<p><img src="/data/2017/2017-11-25-madrid/debod.jpg" alt="Templo de Debod" /></p></li>
<li><p><strong><a href="https://goo.gl/maps/ww5V6MQRsc12">Rosaleda del Parque del Oeste</a></strong> - zahrada s růžemi</p></li>
<li><p><strong>Parque del Oeste</strong> - v jedné části parku je několik bunkrů z občanské války - <a href="https://mapy.cz/s/2dVrn">jsou vyznačené na Mapy.cz</a></p></li>
<li><p><strong><a href="https://goo.gl/maps/iNjmhcSewQT2">El Huerto de las Monjas (tras El Pasaje De Edificios)</a></strong> - schovaný minipark v centru města</p></li>
<li><p><strong><a href="https://goo.gl/maps/v2fCWwsUSrK2">Indalo Tapas Atocha</a></strong> - nevím jak vy, ale my máme problém si vybrat, do jaké hospody apod zajít. Tohle je jedna, kde jsme byli na tapas a bylo to fajn. Takže pokud budete okolo, tak tomu můžete dát šanci.</p></li>
<li><p><strong><a href="https://goo.gl/maps/4qV6FrA76212">La Panetteria</a></strong> - kavárna na náměstí Tirso de Molina. Byli jsme tam za ten týden dokonce 2×.</p></li>
</ul>

<h2 id="praktick%E3%A9">Praktické</h2>

<ul>
<li><p><strong>Metro</strong> - druhý nejlepší způsob dopravy po centru (nejlepší je chodit pěšky). Je potřeba si za 2€ koupit čipovou kartu a do ní potom třeba balíček deseti jízd. Můžete je klidně používat ve více lidech, prostě si u turniketu pípnete postupně oba. A pozor, na cestu z (a na) letiště si k běžné jízdence ještě musíte přikoupit Airport-pass za 3€. Na plánování trasy doporučuji používat Google Maps, fungují dobře.</p></li>
<li><p><strong>Pohledy a známky</strong> - pokud budete posílat pohledy, tak pozor, ať si koupíte správné známky. Správné jsou Correos, které koupíte třeba na poště. Ty se hází do žlutých poštovních schránek, kterých je docela dost. Ale v některých stáncích si můžete omylem koupit známky od něčeho, co se jmenuje "City Post". A ty musíte hodit do nějaké speciální červené schránky, která skoro nikde není. No a pokud si nevšimnete, že nemáte standardní známky a pohled hodíte do běžné poštovní schránky, tak nedorazí.</p></li>
<li><p><strong>Wi-fi</strong> - po městě je spoustu free wi-fi. Většina chce přihlášení přes Facebook, takže doporučuji si na to založit nějaký druhý účet (protože typicky to chce práva na sdílení příspěvků pod vámi).</p></li>
</ul>
]]></content>
        </entry>
            <entry>
            <title type="html"><![CDATA[JavaScript Error Handler Bundle for Symfony]]></title>
            <link href="https://blog.martinhujer.cz/javascript-error-handler-bundle/"/>
            <updated>2017-11-04T00:00:00+00:00</updated>
            <id>https://blog.martinhujer.cz/javascript-error-handler-bundle/</id>
            <content type="html"><![CDATA[<p>I've created Symfony <a href="https://github.com/mhujer/JavaScriptErrorHandlerBundle">JavaScriptErrorHandlerBundle</a> for visualizing accidental errors in JavaScript.</p>

<h2 id="why%3F">Why?</h2>

<p>It is easy to break JavaScript code by an unrelated change. If you have JavaScript-only app, you will notice it immediately, because the app won't render at all (and your framework would report the error somehow).</p>

<p>On the other hand, if you are creating more traditional application with HTML rendered on the server and some interactions enhanced by jQuery, you may not notice that you've broken it. The browser reports the error into the Developer Console, but if you don't have it open, you are out of luck.</p>

<p>My <a href="https://github.com/mhujer/JavaScriptErrorHandlerBundle">JavaScriptErrorHandlerBundle</a> listens to <a href="https://developer.mozilla.org/en-US/docs/Web/API/GlobalEventHandlers/onerror"><code>window.onerror</code> events</a> and converts them to alerts, which are hard to miss.</p>

<p><img src="/data/2017/2017-11-04-javascript-error-handler-bundle/javascript-error-handler-bundle.png" alt="example alert with error" /></p>

<h2 id="how-does-it-work%3F">How does it work?</h2>

<p>The Bundle works automatically with zero configuration. You only have to install it through Composer and register in <code>AppKernel.php</code> (see <a href="https://github.com/mhujer/JavaScriptErrorHandlerBundle">README for instructions</a>).</p>

<p>It registers an event listener, which injects JavaScript snippet with error into the <code>&lt;head&gt;</code> section of the response (similarly to Symfony WebDebugToolbar). By default, the listener is registered only when the <code>%kernel.debug%</code> is set to <code>true</code>, so the error alert won't be ever displayed to your end users. The configuration cab be changed if necessary - e.g. you may want to have enabled also at the staging server.</p>

<h2 id="conclusion">Conclusion</h2>

<p>I know that the bundle is very simple. I wanted to experiment with what it takes to create a proper Bundle, before I work on something more complicated. One of the challenging things was the automatic testing of the container extension (it contains the logic for registering the listener). Luckily, there is <a href="https://github.com/matthiasnoback/SymfonyDependencyInjectionTest">SymfonyDependencyInjectionTest</a> library created by Matthias Noback which makes container extension testing a breeze.</p>

<p>If you have time to dive into the bundle code, can you spot something that can I improve?</p>
]]></content>
        </entry>
            <entry>
            <title type="html"><![CDATA[PHP 7.2 is due in November. What&#039;s new?]]></title>
            <link href="https://blog.martinhujer.cz/php-7-2-is-due-in-november-whats-new/"/>
            <updated>2017-09-07T00:00:00+00:00</updated>
            <id>https://blog.martinhujer.cz/php-7-2-is-due-in-november-whats-new/</id>
            <content type="html"><![CDATA[<blockquote>
  <p>I've published <a href="https://www.zdrojak.cz/clanky/jake-novinky-prinese-php-7-2/">the Czech translation of the article on Zdroják.cz</a>.</p>
</blockquote>

<p>PHP 7.2 is planned to be released on 30th November 2017 (see <a href="https://wiki.php.net/todo/php72#timetable">the timetable</a>). And it comes with two new security features in the core, several smaller improvements and some language legacy clean-ups. In the article, I will describe what the improvements and changes are. I read <a href="https://wiki.php.net/rfc#php_next_72">the RFCs</a>, discussions on <em>internals</em> and <a href="https://github.com/php/php-src/pulls">PRs on Github</a>, so you don't have to.</p>

<p><em>I'll update the article if there are any significant changes in PHP 7.2 until release.</em></p>

<p>You can try the pre-release version right now. Just download it using the links in the <a href="http://php.net/archive/2017.php#id2017-08-31-1">PHP 7.2.0 Release Candidate 1 Released</a>. I've been using it locally for development since the 7.2.0-beta1 without issues.</p>

<h2 id="rfc%3A-argon2-password-hash-link">RFC: Argon2 Password Hash (<a href="https://wiki.php.net/rfc/argon2_password_hash">link</a>)</h2>

<p><a href="http://php.net/password_hash"><code>password_hash</code></a> function has been available in PHP since 5.5. It was designed to be able to utilize different password hashing algorithms. But back then only <code>PASSWORD_BCRYPT</code> was available.</p>

<blockquote>
  <p><strong>IMPORTANT:</strong> If you are using <code>sha1()</code> or <code>md5()</code> for password hashing, please stop reading immediately and go fix your systems to use <code>password_hash()</code>. I recommend reading Michal's article <a href="https://www.michalspacek.com/upgrading-existing-password-hashes">Upgrading existing password hashes</a>.</p>
</blockquote>

<p>PHP 7.2 adds an option to use Argon2i algorithm with <code>PASSWORD_ARGON2I</code> constant:</p>

<pre><code class="php">password_hash('password', PASSWORD_ARGON2I)
</code></pre>

<p>Using <code>PASSWORD_BCRYPT</code> is still perfectly valid and safe option. Argon2i is just another option, which may become a default in the future.</p>

<p>Argon2i supports providing custom cost factors (like providing single <code>cost</code> factor to <code>bcrypt</code>):</p>

<pre><code class="php">$options = [
    'memory_cost' =&gt; PASSWORD_ARGON2_DEFAULT_MEMORY_COST,
    'time_cost' =&gt; PASSWORD_ARGON2_DEFAULT_TIME_COST,
    'threads' =&gt; PASSWORD_ARGON2_DEFAULT_THREADS,
];
password_hash('password', PASSWORD_ARGON2I, $options);
</code></pre>

<p>You should determine appropriate costs for Argon2i by experimenting on the target server (like you do with bcrypt <code>cost</code>).</p>

<p>It is also time to check your password column length! <code>PASSWORD_BCRYPT</code> generates 60 characters long hashes. <code>PASSWORD_ARGON2I</code> hash is 96 characters long. The <a href="http://php.net/password_hash"><code>password_hash</code> documentation</a> recommends columns length of 255 characters to accommodate any future hash (especially when using <code>PASSWORD_DEFAULT</code> as an algorithm):</p>

<blockquote>
  <p><em>It is recommended to store the result in a database column that can expand beyond 60 characters (255 characters would be a good choice).</em></p>
</blockquote>

<p>There is a good article about <a href="https://framework.zend.com/blog/2017-08-17-php72-argon2-hash-password.html">Protecting passwords with Argon2 in PHP 7.2</a> on Zend Framework blog.</p>

<p><strong>Note:</strong> Argon2i is available only if the PHP was compiled with <code>--with-password-argon2</code> flag. (It is included in Windows binaries available from php.net).</p>

<h2 id="rfc%3A-make-libsodium-a-core-extension-link">RFC: Make Libsodium a Core Extension (<a href="https://wiki.php.net/rfc/libsodium">link</a>)</h2>

<p>PHP 7.2 comes with cryptography library libsodium in the core. It was previously available through PECL. There is also a <a href="https://github.com/paragonie/sodium_compat">polyfill available</a> so you can start using it right now (it even supports PHP 5.2.4!).</p>

<p>I don't know much about the cryptography, but the single most important thing I know is this: <em>Don't invent your own cryptography!</em> (See <a href="https://security.stackexchange.com/a/18198">this StackExchange answer</a> for reasoning.).</p>

<p><strong>So just use the <code>sodium_</code> functions instead of implementing it by yourself.</strong></p>

<p>I recommend reading two following articles about upcoming improvements in PHP cryptography (both written by Scott Arciszewski, the author of the Libsodium RFC):</p>

<ol>
<li><p><a href="https://dev.to/paragonie/php-72-the-first-programming-language-to-add-modern-cryptography-to-its-standard-library">PHP 7.2: The First Programming Language to Add Modern Cryptography to its Standard Library</a></p>

<blockquote>
  <p><em>When version 7.2 releases at the end of the year, PHP will be the first programming language to adopt modern cryptography in its standard library.</em></p>
</blockquote></li>
<li><p><a href="https://paragonie.com/blog/2017/07/it-turns-out-2017-is-year-simply-secure-php-cryptography">It Turns Out, 2017 is the Year of Simply Secure PHP Cryptography</a> (by Scott Arciszewski as well).</p></li>
</ol>

<h2 id="other-interesting-changes">Other Interesting Changes</h2>

<h3 id="rfc%3A-object-typehint-link">RFC: Object typehint (<a href="https://wiki.php.net/rfc/object-typehint">link</a>)</h3>

<p>It will be possible to use <code>object</code> as parameter type and as a return type.</p>

<pre><code class="php">&lt;?php declare(strict_types = 1);

function foo(object $definitelyAnObject): object
{
    return 'another string';
}

foo('what about some string?');
// TypeError: Argument 1 passed to foo() must be an object, string given, called in...


foo(new \stdClass());
// TypeError: Return value of foo() must be an object, string returned

</code></pre>

<p><code>object</code> becomes a keyword in 7.2, so make sure you are not using it as a name for a class, interface or trait. It was a <a href="http://php.net/manual/en/reserved.other-reserved-words.php">soft-reserved word since PHP 7.0</a>.</p>

<p>It is useful mainly for libraries (ORMs, DI containers, serializers, <a href="https://externals.io/message/96554#96586">and others</a>). But it may help clean up some of your code as well. In our codebase, it will allow us to improve the helper method used in tests:</p>

<pre><code class="php">class TestUtils
{

    /**
     * @param object $object
     * @param string $propertyName
     * @param mixed $value
     */
    public static function setPrivateProperty($object, string $property, $value): void
    {
        if (!is_object($object)) {
            throw new \Exception('An object must be passed');
        }
</code></pre>

<p>Will be simplified to this:</p>

<pre><code class="php">class TestUtils
{
    public static function setPrivateProperty(object $object, string $property, $value): void
    {
</code></pre>

<h3 id="rfc%3A-parameter-type-widening-link">RFC: Parameter Type Widening (<a href="https://wiki.php.net/rfc/parameter-no-type-variance">link</a>)</h3>

<p>With this change, it is possible to omit the parameter type declaration in the child classes. I know that may sound confusing, so let's have a look at the example:</p>

<pre><code class="php">&lt;?php declare(strict_types = 1);

class LibraryClass 
{
    public function doWork(string $input)
    {

    }
}

class UserClass extends LibraryClass
{
    public function doWork($input)
    {

    }
}

// PHP &lt;7.2.0
// Warning: Declaration of UserClass::doWork($input) should be compatible with LibraryClass::doWork(string $input) in …

// PHP 7.2.0+
// no errors
</code></pre>

<p>It would allow libraries to introduce scalar typehints without breaking subclasses created by the library users. But it is rather theoretical possibility because the library cannot do the same for the return types. And when the library is adding parameter typehints, it makes sense to add return types as well.</p>

<p>Omitting type hints in subclasses follows the <a href="https://en.wikipedia.org/wiki/Liskov_substitution_principle">Liskov substitution principle - LSP</a> because it widens the accepted types. But the subclass cannot omit return typehints, because that would widen the possible return types (and that is LSP violation).</p>

<p>This behaviour was also changed for abstract classes in separate RFC: <a href="https://wiki.php.net/rfc/allow-abstract-function-override">RFC: Allow abstract function override</a>.</p>

<h3 id="rfc%3A-counting-of-non-countable-objects-link">RFC: Counting of non-countable objects (<a href="https://wiki.php.net/rfc/counting_non_countables">link</a>)</h3>

<p>Did you know, that it is possible to count scalar values? Well, it does not really do much counting, it only returns 1 for scalars.</p>

<pre><code class="php">&lt;?php

var_dump(count(null)); // int(0)
var_dump(count(0)); // int(1)
var_dump(count(4)); // int(1)
var_dump(count('4')); // int(1)

</code></pre>

<p>Since PHP 7.2, it will begin emitting a warning:</p>

<pre><code>Warning: count(): Parameter must be an array or an object that implements Countable in /in/4aIl2 on line 3
</code></pre>

<p>I really like this change, because no one writes such code intentionally, but rather as a bug that needs fixing.</p>

<p>I guess that you may find some of those is your codebase as well - have a look at a less obvious example:</p>

<pre><code class="php">&lt;?php declare(strict_types = 1);

class Data
{
    /** @var string[] */
    private $data;

    public function addOne(string $item)
    {
        if (count($this-&gt;data) &gt;= 5) {
            throw new \Exception('too much data');
        }

        $this-&gt;data[] = $item;
    }
}

$data = new Data();
$data-&gt;addOne('item1');
$data-&gt;addOne('item2');
$data-&gt;addOne('item3');

// Warning: count(): Parameter must be an array or an object that implements Countable in ...
</code></pre>

<p>It will report a warning, because you are counting a <code>null</code> value in the <code>if</code>.</p>

<h3 id="rfc%3A-deprecations-for-php-7.2-link">RFC: Deprecations for PHP 7.2 (<a href="https://wiki.php.net/rfc/deprecations_php_7_2">link</a>)</h3>

<p>Can be also called <em>"Nikita Popov's language clean-up"</em> :-)</p>

<p>The following will throw a deprecation warning in PHP 7.2 and will be removed later (probably in 8.0). See <a href="https://wiki.php.net/rfc/deprecations_php_7_2">the RFC</a> for detailed explanation of each one:</p>

<ul>
<li><code>__autoload()</code> - use <a href="http://php.net/spl_autoload_register"><code>spl_autoload_register()</code></a> instead</li>
<li><code>$php_errormsg</code> - use <a href="http://php.net/error_get_last"><code>error_get_last()</code></a> instead</li>
<li><code>create_function()</code> - use closures instead</li>
<li><code>mbstring.func_overload</code> (ini setting) - use <code>mb_*</code> functions directly</li>
<li><code>(unset)</code> cast - this is not deprecating <code>unset($var)</code> but <code>$foo = (unset) $bar</code> which is equal to <code>$foo = null</code> (yes, strange one)</li>
<li><code>parse_str()</code> without second argument - directly creating variables when parsing query string is not something you should be doing (<code>register_globals</code> anyone?)</li>
<li><code>gmp_random()</code> - use <code>gmp_random_bits()</code> and <code>gmp_random_range()</code> instead</li>
<li><code>each()</code> - use <code>foreach</code> instead (it is more than 10 times faster)</li>
<li><code>assert()</code> with string argument - it is using <code>eval()</code> internally!</li>
<li><code>$errcontext</code> argument of error handler - use <code>debug_backtrace()</code> instead</li>
</ul>

<h2 id="smaller-changes">Smaller changes</h2>

<h3 id="rfc%3A-get_class-disallow-null-parameter-link">RFC: get_class() disallow null parameter (<a href="https://wiki.php.net/rfc/get_class_disallow_null_parameter">link</a>)</h3>

<p>Did you know, that <code>get_class()</code> without parameters returns the same value as <code>__CLASS__</code>? I didn't. But the RFC does not change this.</p>

<pre><code class="php">&lt;?php

class MyClass
{
    public function myInfo()
    {
        var_dump(get_class()); // string(7) "MyClass"
        var_dump(__CLASS__); // string(7) "MyClass"
    }
}

$a = new MyClass();
$a-&gt;myInfo();

var_dump(get_class($a)); // string(7) "MyClass"
</code></pre>

<p>The RFC deprecates calling it with <code>null</code> as parameter. Consider this example from the RFC. If the item is fetched from the repository and <code>$result</code> is not null, it will print the class name of the fetched object. But if it is null, <code>Foo</code> will be printed.</p>

<pre><code class="php">class Foo
{

    function bar($repository)
    {
        $result = $repository-&gt;find(100);

        echo get_class($result);
    }
}

// In 7.2: Warning: get_class() expects parameter 1 to be object, null given in ...
</code></pre>

<h3 id="rfc%3A-allow-loading-extensions-by-name-link">RFC: Allow loading extensions by name (<a href="https://wiki.php.net/rfc/load-ext-by-name">link</a>)</h3>

<p>If you configured the PHP extensions before 7.2, you had to use full filename in the <code>.ini</code> file:</p>

<p>On Windows:</p>

<pre><code class="ini">extension=php_mbstring.dll
</code></pre>

<p>On Linux:</p>

<pre><code class="ini">extension=mbstring.so
</code></pre>

<p>That's fine if you are using only one platform. But it gets a bit harder, if you need to write some automation scripts supporting multiple platforms. It was improved in 7.2 and now you can use this both on Linux and Windows:</p>

<pre><code class="ini">extension=mbstring
</code></pre>

<p>Legacy syntax is still supported, but it is recommended to use the new one.</p>

<h3 id="rfc%3A-deprecate-and-remove-bareword-unquoted-strings-link">RFC: Deprecate and Remove Bareword (Unquoted) Strings (<a href="https://wiki.php.net/rfc/deprecate-bareword-strings">link</a>)</h3>

<p>This is another step in making PHP safer to use. If you mistype a constant in 7.2, it will throw a warning instead of notice (and will throw an error in PHP 8.0).</p>

<p>Simplest example is this:</p>

<pre><code class="php">&lt;?php
var_dump(NONEXISTENT_CONSTANT);


// PHP 7.1
// Notice: Use of undefined constant NONEXISTENT_CONSTANT - assumed 'NONEXISTENT_CONSTANT' in …

// PHP 7.2
// Warning: Use of undefined constant NONEXISTENT_CONSTANT - assumed 'NONEXISTENT_CONSTANT' (this will throw an Error in a future version of PHP) in …
</code></pre>

<p>I really like the bug examples <a href="https://wiki.php.net/rfc/deprecate-bareword-strings">in the RFC</a> showing what it's aiming to prevent:</p>

<pre><code class="php">$foo = flase; // typo!
// ...
if ( $foo ) {
   var_dump($foo); // string(5) "flase"
}
</code></pre>

<p>And:</p>

<pre><code class="php">$found = false;
foreach ( $list as $item ) {
   if ( is_null($item) ) {
       contniue; // this statement issues a notice and does nothing
   }
   // lines assuming $item is not null
}
</code></pre>

<h3 id="rfc%3A-trailing-commas-in-list-syntax-link">RFC: Trailing Commas in List Syntax (<a href="https://wiki.php.net/rfc/list-syntax-trailing-commas">link</a>)</h3>

<p>It has <a href="https://3v4l.org/J8r9B">always been possible</a> to use trailing comma after last array item:</p>

<pre><code class="php">$foo = [
    'foo',
    'bar',
];
</code></pre>

<p>It is useful for creating clean diffs in VCS and makes adding new items to the list simple.</p>

<p>This RFC proposed adding an optional trailing comma to all list-like places:</p>

<ul>
<li>Grouped namespaces</li>
<li>Function/method arguments (declarations &amp; calls)</li>
<li>Interface implementations on a class</li>
<li>Trait implementations on a class</li>
<li>Class member lists</li>
<li>Inheriting variables from the parent scope in anonymous functions</li>
</ul>

<p>I especially hoped for method arguments declarations and calls. But it did not pass the vote (which needed 2/3 majority, as it is a language change).</p>

<p>Surprisingly, only the <em>"Grouped namespaces"</em> passed:</p>

<pre><code class="php">use Foo\Bar\{ 
    Foo,
    Bar, 
    Baz, 
}; 

// note the comma after "Baz"
</code></pre>

<h2 id="conclusion">Conclusion</h2>

<p>PHP 7.2 will contain new security features (sodium, Argon2i), several language improvements (<code>object</code> typehint, type widening) and a variety of minor changes that polish legacy parts of the language.</p>

<p>The <a href="http://php.net/archive/2017.php#id2017-08-31-1">RC1</a> was released on 31st August, so it is now a right time to try it out. If you can't or don't want to use it locally for development just yet, you should at least run your test suite against PHP 7.2 to see if there is anything to be fixed. I think there won't be many compatibility issues in a well-managed codebase.</p>

<p>If you are maintaining an open-source project, you should add 7.2 to TravisCI build matrix to ensure that your users won't encounter any compatibility issues. Or you can require PHP 7.2 in the next major version <a href="https://github.com/doctrine/doctrine2/pull/6577">like Doctrine ORM will</a>.</p>

<p>Thank you, Sara and Remi, and all the contributors for making this PHP release great!</p>

<p>What are you looking forward to most in the PHP 7.2?</p>
]]></content>
        </entry>
            <entry>
            <title type="html"><![CDATA[Don&#039;t Use Entities in Symfony Forms. Use Custom Data Objects Instead]]></title>
            <link href="https://blog.martinhujer.cz/symfony-forms-with-request-objects/"/>
            <updated>2017-08-23T00:00:00+00:00</updated>
            <id>https://blog.martinhujer.cz/symfony-forms-with-request-objects/</id>
            <content type="html"><![CDATA[<blockquote>
  <p>First part of this article explains why entities should not be used directly in Symfony Forms. Second part presents an approach which solves most of the problems presented in the first part.</p>
</blockquote>

<p>Let's start with stating that <strong>using entities for validation in Symfony Forms</strong> is widely used and widely recommend approach. Even the <a href="https://symfony.com/doc/current/forms.html">official documentation</a> suggests it.</p>

<p><strong>And I don't think it is a good idea!</strong></p>

<p><strong>Why?</strong></p>

<h3 id="1.-an-entity-should-be-always-valid.">1. An entity should be always valid.</h3>

<p>An entity should be always valid. It should not be possible for the entity to get to some inconsistent state. And that's exactly what the form validation is doing. When the form is submitted, the data are injected (through public properties or setters) into the entity and validated. And even if the validation fails, the invalid data are kept there and you have an invalid entity at hand.</p>

<blockquote>
  <p>Read <a href="https://ocramius.github.io/doctrine-best-practices/">those slides</a> from Ocramius or <a href="https://vimeo.com/134178140">watch the video</a> for great explanation what is means to have a valid entity (and much more).</p>
</blockquote>

<p>It's also not that hard to imagine the situation when this can cause you serious trouble. If the entity is already managed by EntityManager (because it is an <code>updateAction</code>) and there is a <code>$entityManager-&gt;flush()</code> call lurking in some listener, you'd end up with invalid data stored in database.</p>

<h3 id="2.-change%21-change%21-change%21">2. Change! Change! Change!</h3>

<p>The only sure thing about the software development is "change". Eventually you will need to change the structure of the form, maybe split it in two-step form. And the form fields will no longer map exactly 1:1 to entity's fields.</p>

<h3 id="3.-layers-separation">3. Layers separation</h3>

<p>It breaks the layers separation. Each layer should depend only on the deeper ones, not the other way around.</p>

<hr />

<p>What can we do instead of using entities in forms? Symfony documentation describes <a href="https://symfony.com/doc/current/form/without_class.html">how to use forms with data stored in array</a>. It is a viable solution, but it has disadvantages as well. Some I can think of is that you won't get code completion in IDE for the form data. Or that it is hard to statically analyze arrays with tools such as <a href="https://github.com/phpstan/phpstan">PHPStan</a>.</p>

<p>And there is another solution, the one I prefer.</p>

<h2 id="custom-data-classes-for-the-win">Custom Data Classes for the win</h2>

<p>To get around the disadvantages mentioned above, I suggest using a custom class to represent the form data.</p>

<p>Let's have a look at the example:</p>

<pre><code class="php">use Symfony\Component\Validator\Constraints as Assert;

class CreateArticleRequest
{

    /**
     * @Assert\NotBlank()
     * @Assert\Length(min="10", max="100")
     * @var string
     */
    public $title;

    /**
     * @Assert\NotBlank()
     * @var string
     */
    public $content;

    /**
     * @Assert\DateTime()
     * @var \DateTimeImmutable
     */
    public $publishDate;

}
</code></pre>

<p>It is a simple class that has some public properties and validator annotations. The main advantage is that is has nothing to do with the actual entity. <code>CreateArticleRequest</code> can handle as much of invalid data as you want and it won't cause you any trouble.</p>

<p>Second step is using the request object in the controller. You can use it the same way you'd use the entity (the following code should be self-explanatory):</p>

<pre><code class="php">  /**
     * @Route("/article/create/", name="article_create")
     */
    public function createAction(Request $request)
    {
        // create an instance of an empty CreateArticleRequest
        $createArticleRequest = new CreateArticleRequest();

        // create a form but with a request object instead of entity
        $form = $this-&gt;createForm(ArticleFormType::class, $createArticleRequest);
        $form-&gt;handleRequest($request);

        if ($form-&gt;isSubmitted() &amp;&amp; $form-&gt;isValid()) {

            // ArticleFacade creates instance of an Article,
            // persists it and flushes the EntityManager.
            // (details are out of scope of this article)

            $article = $this-&gt;articleFacade-&gt;createArticle(
                $createArticleRequest-&gt;title,
                $createArticleRequest-&gt;content,
                $createArticleRequest-&gt;publishDate
            );

            // ... use $article to add title to flash message or something

            return $this-&gt;redirectToRoute('articles_list');
        }

        // render the form if it is the first request or if the validation failed
        return $this-&gt;render('article/add-article.html.twig', [
            'form' =&gt; $form-&gt;createView(),
        ]);
    }
</code></pre>

<p>And for the sake of completeness, the source of <code>ArticleFormType</code>:</p>

<pre><code class="php">class ArticleFormType extends \Symfony\Component\Form\AbstractType
{

    public function buildForm(FormBuilderInterface $builder, array $options): void
    {
        $builder
            -&gt;add('title', TextType::class, [
                'label' =&gt; 'Article title',
            ])
            -&gt;add('content', TextareaType::class, [
                'label' =&gt; 'Article title',
            ])
            -&gt;add('publishDate', DateTimeType::class, [
                'label' =&gt; 'Publish on',
            ])
            -&gt;add('save', SubmitType::class, [
                'label' =&gt; 'Save',
            ]);
    }
}
</code></pre>

<p>I call the data class <code>CreateArticleRequest</code> because it is a <em><code>Request</code></em> to create an article. You will probably also have a <code>UpdateArticleRequest</code> class with different properties (in some cases, both classes may be the same, so one <code>ArticleRequest</code> would be sufficient).</p>

<p>The <code>*Request</code> suffix may cause some confusion with the <code>Request</code> class which represents a HTTP request. If that is your case, you are free to change the suffix to <code>*Data</code> and use a class called <code>CreateArticleData</code>.</p>

<h2 id="what-about-update-form%3F">What about update form?</h2>

<p>One of the specifics of the update is that it won't necessarily have the exact same fields as the "create". In the example, we don't want to update the <code>publishDate</code> field in the entity. The <code>UpdateArticleRequest</code> will look like this:</p>

<pre><code class="php">use Symfony\Component\Validator\Constraints as Assert;

class UpdateArticleRequest
{

    /**
     * @Assert\NotBlank()
     * @Assert\Length(min="10", max="100")
     * @var string
     */
    public $title;

    /**
     * @Assert\NotBlank()
     * @var string
     */
    public $content;

    public static function fromArticle(Article $article): self
    {
        $articleRequest = new self();
        $articleRequest-&gt;title = $article-&gt;getTitle();
        $articleRequest-&gt;content = $article-&gt;getContent();

        return $articleRequest;
    }
}
</code></pre>

<p>You can see that the <code>$publishDate</code> field is missing, but more importantly, we have a new method there - <code>fromArticle(Article $article)</code>. It allows you to prepopulate the data from the existing article.</p>

<p>Check the following example of <code>updateAction()</code> to see how to use it in controller:</p>

<pre><code class="php">    /**
     * @Route("/article/update/{id}/", name="article_update")
     */
    public function updateAction(Article $article, Request $request)
    {
        // the $article argument is converted from {id} by implicit ParamConverter

        // pre-populate the UpdateArticleRequest instance with the data from the article
        $updateArticleRequest = UpdateArticleRequest::fromArticle($article);

        $form = $this-&gt;createForm(UpdateArticleFormType::class, $updateArticleRequest);
        $form-&gt;handleRequest($request);

        if ($form-&gt;isSubmitted() &amp;&amp; $form-&gt;isValid()) {

            // ArticleFacade updates instance of an Article and flushes the EntityManager.
            // (details are out of scope of this article)

            $this-&gt;articleFacade-&gt;updateArticle(
                $article,
                $updateArticleRequest-&gt;title,
                $updateArticleRequest-&gt;content
            );

            // ... use $article to add title to flash message or something

            return $this-&gt;redirectToRoute('articles_list');
        }

        return $this-&gt;render('article/edit-article.html.twig', [
            'form' =&gt; $form-&gt;createView(),
        ]);
    }
</code></pre>

<p>You may think - that's a lot of code to write! I agree, but rest assured it is worth it in the long run. If your app contains some business logic and is not just a plain CRUD, it will eventually need different fields and validation rules during <em>create</em> and <em>update</em>. Then you will make good use of this extra code you had written.</p>

<h2 id="conclusion">Conclusion</h2>

<p>In the article, I suggested why it may not be the best idea to use entities in Symfony Forms. The second part of the article proposes a way how to tackle this problem - by using a custom object instead of entity to carry the data and handle the validation.</p>

<p>There are two more takeaways:</p>

<ol>
<li>Always separate the application layers.</li>
<li>Do not blindly follow the documentation (or other developers).</li>
</ol>

<p><strong>Do you use similar solution in your projects? If you are using entities, have you already encountered any problems?</strong></p>

<p>Finally, you may want to read two related articles: <a href="https://stovepipe.systems/post/avoiding-entities-in-forms">Avoiding Entities in Forms</a> and <a href="https://stovepipe.systems/post/rethinking-form-development">Rethinking Form Development</a> (written by Iltar van der Berg).</p>
]]></content>
        </entry>
            <entry>
            <title type="html"><![CDATA[Jak začít s Dockerem? Od závislostí.]]></title>
            <link href="https://blog.martinhujer.cz/jak-zacit-s-dockerem-od-zavislosti/"/>
            <updated>2017-07-13T00:00:00+00:00</updated>
            <id>https://blog.martinhujer.cz/jak-zacit-s-dockerem-od-zavislosti/</id>
            <content type="html"><![CDATA[<p>V <a href="https://www.driveto.cz/">Drivetu</a> jsme začali používat Docker, ale tak trochu netradičně. Používáme ho totiž (zatím) jen na externí závislosti (Rabbit, Elastic, Cerebro, Kibana) a PHP + MariaDB máme stále nainstalované standardně.</p>

<p>Výhodou je, že takhle si Docker vyzkoušíme relativně bez rizika. Zjistíme, jak se chová, jestli všem funguje a podobně. Zároveň už nám bude rovnou přinášet hodnotu tím, že budeme mít všichni stejné verze a konfiguraci závislostí.</p>

<p>Bylo by cool mít v Dockeru všechno, ale tipuji, že zatím by nám to práci spíš přidělávalo, než šetřilo. Už třeba kvůli pomalému filesystému sdílených složek <a href="https://github.com/docker/for-win/issues/188">z Windows</a> nebo <a href="https://github.com/docker/for-mac/issues/77">z Macu</a>. Každopádně uvidíme v budoucnu - mít celé prostředí připravené bez nutnosti instalace a konfigurace čehokoliv je lákavá představa.</p>

<h2 id="instalace-dockeru-na-windows">Instalace Dockeru (na Windows)</h2>

<ul>
<li>Musíte mít Windows 10 Pro (v Home není Hyper-V)</li>
<li>V <em>Turn Windows features on or off</em> povolte Hyper-V</li>
<li><a href="https://store.docker.com/editions/community/docker-ce-desktop-windows">Stáhněte si Docker</a></li>
<li>Nainstalujte</li>
<li>pomocí <code>docker version</code> ověřte, že máte nainstalováno správně</li>
</ul>

<h2 id="nastaven%E3%AD-rabbitmq-v-dockeru">Nastavení RabbitMQ v Dockeru</h2>

<p>Pro nastavení používám Docker Compose, který umožňuje v jednom konfiguračním souboru definovat více služeb, které lze potom najednou spustit.</p>

<p>V rootu projektu vytvoříme soubor <code>docker-compose.yml</code> s následujícím obsahem (vysvětlím níže):</p>

<pre><code class="yaml">version: '3'
services:
    rabbitmq:
        image: rabbitmq:3.6.10-management
        hostname: driveto-rabbit
        ports:
            - 5672:5672
            - 15672:15672
</code></pre>

<ul>
<li><p><code>version: '3'</code> na začátku souboru je verze konfiguračního souboru pro <code>docker-compose</code>.</p></li>
<li><p>v <code>services</code> jsem definoval službu pojmenovanou <code>rabbitmq</code></p></li>
<li><p>použije se pro ni image <code>rabbitmq</code> z <a href="https://hub.docker.com/_/rabbitmq/">Docker Hubu</a> ve verzi <code>3.6.10-management</code>. Verzi by šlo podobně jako v Composeru definovat volněji, třeba jen <code>3.6</code> (nebo dokonce <code>latest</code>). Jenže tím se připravíme o výhodu toho, že všichni používají stejné prostředí, takže se doporučuji držet co nejpřesnější specifikace verze. <code>-management</code> v určení verze znamená, že jde o image, který obsahuje předinstalovaný <a href="https://www.rabbitmq.com/management.html">Management plugin</a> - webové rozhraní pro monitoring a konfiguraci RabbitMQ.</p></li>
<li><p><code>hostname</code> je důležité nastavit, protože ho RabbitMQ používá jako identifikátor při ukládání dat (je to popsané v dokumentaci na <a href="https://hub.docker.com/_/rabbitmq/">Docker Hubu</a> v sekci <em>How to use this image</em>)</p></li>
<li><p><code>ports</code> definují mapování portů - <code>HOST:CONTAINER</code> - první je port na hostitelským systému, druhý je port kontejneru. V ukázce mám přesměrované dva porty: <code>5672</code> pro komunikaci s RabbitMQ a <code>15672</code> pro webové rozhraní.</p></li>
</ul>

<h2 id="spu%E5%A1t%E4%9Bn%E3%AD-rabbitmq">Spuštění RabbitMQ</h2>

<ol>
<li>v adresáři, kde je <code>docker-compose.yml</code> zavoláme <code>docker-compose up</code></li>
<li>ten stáhne potřebné image a nastartuje kontejner s Rabbitem</li>
<li>RabbitMQ má vytvořeného uživatele <code>guest</code> s heslem <code>guest</code> a výchozí vhost <code>/</code></li>
<li>Webové rozhraní je přístupné na <code>http://localhost:15672</code></li>
</ol>

<p><code>docker-compose up</code> můžete spouštět v detached režimu přepínačem <code>-d</code>. Poběží pak na pozadí a nebude nutné nechat otevřenou konzoli. Logy z kontejnerů pak zobrazíte pomocí <code>docker-compose logs</code>. Na Windows používám jako konzoli <a href="http://cmder.net/">cmder</a>, kde si <code>docker-compose</code> nechávám běžet v jednom tabu na popředí, abych logy viděl průběžně.</p>

<h2 id="z%E3%A1v%E4%9Brem">Závěrem</h2>

<p>V článku ukázal, že začít s Dockerem není vůbec složité a zároveň že jde začít i jinak než zdockerizováním celé aplikace. Používáte Docker? Pro celou aplikaci nebo jen podobně jako my?</p>

<p>Pokud si budete Docker podle článku nastavovat a něco vám nebude fungovat, tak mi napište do komentářů nebo do kanálu <code>#docker</code> na <a href="https://pehapkari.cz/#slack">Slacku Pehapkaři.cz</a>.</p>
]]></content>
        </entry>
            <entry>
            <title type="html"><![CDATA[Profilování PHP aplikací pomocí Blackfire]]></title>
            <link href="https://blog.martinhujer.cz/profilovani-php-aplikaci-pomoci-blackfire/"/>
            <updated>2017-04-06T00:00:00+00:00</updated>
            <id>https://blog.martinhujer.cz/profilovani-php-aplikaci-pomoci-blackfire/</id>
            <content type="html"><![CDATA[<p>O tom, že je rychlost aplikace důležitá, asi není potřeba diskutovat. Zrychlit aplikaci už tak snadné není. V článku vám předvedu, jak s pomocí Blackfire snadno odhalíte slabá místa vaší PHP aplikace.</p>

<p><strong><a href="https://www.zdrojak.cz/clanky/profilovani-php-aplikaci-pomoci-blackfire/">Článek vyšel</a> na serveru Zdroják.cz</strong></p>
]]></content>
        </entry>
            <entry>
            <title type="html"><![CDATA[Las Palmas, Gran Canaria - kam na výlety?]]></title>
            <link href="https://blog.martinhujer.cz/las-palmas-gran-canaria-kam-na-vylety/"/>
            <updated>2017-03-07T00:00:00+00:00</updated>
            <id>https://blog.martinhujer.cz/las-palmas-gran-canaria-kam-na-vylety/</id>
            <content type="html"><![CDATA[<p>Letos jsem opět vyrazil na měsíc do Las Palmas jako digitální nomád. Už tu máme něco navýletováno, takže jsem se rozhodl sepsat, kam se dá podnikat. Kupodivu spoustu výletů se dá zvládnout i místními autobusy.</p>

<h2 id="autobusy">Autobusy</h2>

<p>Na Gran Canarii fungují meziměstské <a href="http://www.globalsu.net/">autobusy Global</a>. Trasy doporučuji hledat na Google Maps a pak <a href="http://www.globalsu.net/es/lineas.php">ověřit</a>, že se nezměnil jízdní řád. Pozor na dny v týdnu a státní svátky (doporučuji zapnout v Google Calendar). Většina jich jezdí ze San Telmo, což je autobusové nádraží ve Veguetě (dostanete se tam pěšky nebo městským autobusem).</p>

<p>V Las Palmas fungují <a href="http://www.guaguas.com/">městské autobusy GuaGua</a>. Pokud tu budete déle, tak se vyplatí si za €1.5 koupit bezkontaktní kartu, do které se dá nabíjet kredit. Jedna jízda pak stojí €0.85. Kartu pak jde dobíjet ve žlutých automatech. Jo a mají mobilní aplikaci, která vypadá docela použitelně.</p>

<p>ProTip: Pokud má autobus napsáno <em>FS</em> nebo <em>Fuera del servicio</em>, tak to není místo, ale je to "Mimo provoz" - takže autobus jede buď do garáže nebo to řidič zapomněl přepnout ;-)</p>

<p>ProTip2: Pokud letíte do Berlína v 7:15 ráno, tak se to dá v pohodě stihnout autobusem č. 1 v 5:00 ze San Telma (a tam se dá z Las Palmas dostat nočními L1 nebo L2).</p>

<h2 id="kola-zat%E3%ADm-nem%E3%A1m-vyzkou%E5%A1en%E3%A9">Kola (Zatím nemám vyzkoušené)</h2>

<p>Zatím to nemám vyzkoušené, ale mělo by jít si zřídit přístup na <a href="http://www.bybikelpa.com/">půjčování kol bybike</a>.</p>

<p>Potřebujete na to bezkontaktní Guagua kartičku (viz výše). Dále se podle <a href="http://www.bybikelpa.com/index.php?option=com_content&amp;view=article&amp;id=12&amp;Itemid=11&amp;lang=en">postupu na webu</a> zaregistrujete, pak až dva pracovní dny počkáte na schválení a následně se dojdete osobně ověřit do Guagua pobočky (třeba na Santa Catalině). A pak už půjčujete a jezdíte. Měli by mít i mobilní appku s mapou míst pro kola.</p>

<p><a href="http://www.bybikelpa.com/index.php?option=com_content&amp;view=article&amp;id=1&amp;Itemid=2">Podle mapy</a> se to zdá ideální na cestu do/z Veguetty.</p>

<h2 id="kam-v-las-palmas">Kam v Las Palmas</h2>

<p>(nejsou nijak seřazené)</p>

<h3 id="las-canteras">Las Canteras</h3>

<p><a href="https://goo.gl/maps/6gnjcEP3H922">Las Canteras</a> je hlavní několikakilometrová pláž v Las Palmas. Vlevo končí <a href="https://goo.gl/maps/1kPwtQCm4hF2">auditoriem</a> a vpravo Isletou. V levé části je hlavně pro surfaře, nejhezčí na ležení a koupání je to v pravé části. Když tam budete, tak sledujte vlajky. Zelená je OK, žlutá je typicky kvůli vlnám a červená je kvůli velkým vlnám. A letos jsme naneštěstí dost často viděli červenou s doplňkovou bílou s medúzami :-(</p>

<p>Pokud se vyvalíte na sluníčko, tak si dejte pozor na příliv, během pár hodin se moře přiblíží víc, než byste čekali.</p>

<h3 id="isleta">Isleta</h3>

<p>Ostrov na konci Las Canteras má napříč asi 200 m, takže je vidět z jedné strany na druhou. A zároveň tam začíná Isleta. Ta se vyznačuje tím, že je tam <a href="https://goo.gl/maps/bz3vtjPLjoH2">kopec s křížem</a>, ze kterého je pěkně vidět Las Palmas. Typicky tam dost fouká. Zleva od kříže se dá dojít k <a href="https://goo.gl/maps/WJPxzJQ1sJK2">jeskyním původních obyvatel</a> (resp. dalo se dříve, teď už se tam nesmí a může se jen dívat od závory). A když půjdete od kříže vpravo, tak se dá dojít až dolů k moři. Je to tak ideální na pozorování vln. A pak se podél moře dá dojít zpět do Las Palmas.</p>

<h3 id="vegueta---historick%E3%A9-centrum">Vegueta - historické centrum</h3>

<p>Ve Veguetě stojí za to určitě prochodit okolí <a href="https://goo.gl/maps/4m9jav32EAE2">katedrály</a>, <a href="https://goo.gl/maps/a3ZEjnhLtcB2">Casa de Colón</a>. Určitě nevynechte <a href="https://goo.gl/maps/cAtREPBnR6C2">Museo Canario</a> o historii Kanárských ostrovů. V pondělí a ve středu mezi 17 - 20 h mají vstup zdarma.</p>

<h3 id="tapas-night-ve-veguet%E4%9B">Tapas night ve Veguetě</h3>

<p>Každý čtvrtek večer (od osmi, možná až od devíti) se ve Veguetě koná Tapas Night. Znamená to, že v <a href="https://goo.gl/maps/TFh52J1ghEs">několika ulicích</a> nabízejí restaurace tapas (resp. pinchos – jednohubky) s různými zajímavými věcmi. Typicky stojí €1 nebo €2 a za další €1 k tomu máte pivo (třeba Tropical nebo Tropical limón).</p>

<p>Většinou jednu cestu chodíme pěšky a druhou jezdíme autobusem. Můžete jít buď městem nebo po <a href="https://goo.gl/maps/wb4Dg4F7JmT2">chodníku/cyklostezce podél moře</a>.</p>

<h3 id="santa-catalina---3d-sv%E4%9Btad%E3%ADly-a-vlajky">Santa Catalina - 3D světadíly a vlajky</h3>

<p><a href="https://goo.gl/maps/gbdooUcX2py">V rohu Parque de Santa Catalina</a> najdete pseudosousoší světadílů a jednotlivých vlajek.</p>

<h3 id="centro-comercial-las-arenas---primark">Centro Comercial Las Arenas - Primark</h3>

<p>V <a href="https://goo.gl/maps/vhqXr152PyE2">Las Arenas</a> někoho může potěšit Primark. My tam ale raději chodíme do Carrefouru pro čerstvé ryby (steak z tuňáka mňam).</p>

<h3 id="churros-v-madrile%E3%B1a">Churros v Madrileña</h3>

<p><a href="https://goo.gl/maps/QDex1UyPjcQ2">Madrileña</a> je naše oblíbené místo, kam chodíme na churros.</p>

<h3 id="pulpo-frito-v-%22el-paseo%22">Pulpo frito v "El Paseo"</h3>

<p><a href="https://goo.gl/maps/zD8cMWyPfGp">Restaurante Terraza "El Paseo"</a> najdete na konci Las Canteras u Auditoria. Dělají dobré grilované ryby a hlavně pulpo frito (chobotnici). Mňam.</p>

<h3 id="parque-del-estadio-insular">Parque del Estadio Insular</h3>

<p><a href="https://goo.gl/maps/iDghUguw8d32">Parque del Estadio Insular</a> je park postavený ze stadionu. V roce 2015 vzali rozpadlý stadion, kus tribun zbourali a udělali z něj park. Vevnitř je mimo jiné kavárna s nadstandardně dobrou kávou (na místní poměry).</p>

<h3 id="calle-cuatro-ca%E3%B1ones">Calle Cuatro Cañones</h3>

<p>Z <a href="https://goo.gl/maps/2DamoD88WxK2">Calle Cuatro Cañones</a> je večer hezký výhled na osvětlené město.</p>

<h3 id="technick%E3%A9-muzeum">Technické muzeum</h3>

<p>V technickém muzeu <a href="https://goo.gl/maps/VmzPp9FNx4M2">Museo Elder de la Ciencia y la Tecnología</a> jsem zatím nebyl, ale všichni, kdo tam byli, si ho pochvalovali.</p>

<h3 id="karneval">Karneval</h3>

<p>Pokud v Las Palmas budete během února, tak si v ulicích určitě všimnete spousty lidí v maskách. Je totiž karneval, během kterého se konají různá vystoupení a soutěže masek (volba královny plesu atd.). Vše vrcholí průvodem městem a následným upálením sardinky na Las Canteras (a ohňostrojem). Program <a href="http://lpacarnaval.com/en/">mají na webu</a>.</p>

<p><img src="/data/2017/2017-03-07-las-palmas-gran-canaria-kam-na-vylety/sardinka.jpg" alt="Sardinka" /></p>

<h3 id="castillo-de-la-luz">Castillo de la Luz</h3>

<p><a href="https://goo.gl/maps/TCwDHRsPsKs">Castillo de la Luz</a> pevnost obklopená parkem. Vevnitř je nějaké umění (nebyl jsem se podívat).</p>

<h2 id="p%E5%BFj%E4%9Dov%E3%A1n%E3%AD-auta">Půjčování auta</h2>

<p>Půjčení auta vyjde od €40/den + benzín. Půjčovali jsme v <a href="http://rentacartirma.com/?lang=en">Tirmě</a> a <a href="http://www.cicar.com/">Cicar</a>. Vzhledem k tomu, že večer není v centru šance zaparkovat (jsou obsazená i místa, kde byste se to styděli zaparkovat). <a href="https://goo.gl/maps/k3CSnHzBWtD2">Parkovací dům</a> přijde třeba na €10 na noc. V tomhle má výhodu Cicar, protože pokud půjčujete jen na jeden den tak nemusíte řešit parkování a auto vrátíte přímo do jejich parkovacího domu (klidně v noci, a klíče hodíte do schránky u jejich kanceláře).</p>

<p>Při ježdění v centru určitě nezapomeňte na navigaci (offlinové Google Maps fungují pěkně), protože město se skládá především z jednosměrek.</p>

<h2 id="v%E3%BDlety">Výlety</h2>

<p>(většina dosažitelná autobusem, nejsou nijak seřazené)</p>

<h3 id="trh-v-teroru">Trh v Teroru</h3>

<p><a href="https://goo.gl/maps/ps9RqkftDiS2">Teror</a> je městečko, které je významné tím, že se tam kdysi pastýřům zjevila panenka Marie, takže tam postavili <a href="https://goo.gl/maps/c3SBQRQG9wm">baziliku</a>. A kromě toho je každou neděli v centru trh. Místní specialitou je speciální chorizo, které je něco jako mazací salám. A kolem €3 vám udělají <em>pan de chorizo con queso</em> - tedy bagetu s chorizem a sýrem. A také prodávají spoustu různých divných sladkých věcí - na váhu, takže můžete ochutnávat.</p>

<p>Pokud vám centrum města nestačí (nám nestačí), tak doporučuji výšlap na Cruz de la Hoya Alta. Záznam z <a href="https://www.wikiloc.com/wikiloc/view.do?id=16667695">naší trasy jsem dal na wikiloc</a>, který si ještě můžete zkrátit tím, že od kříže už dál nepůjdete (ono tam totiž stejně nic není, jen se nám to pořád nechtělo otočit zpátky).</p>

<h3 id="arucas">Arucas</h3>

<p>Město <a href="https://goo.gl/maps/j9TyDW8qY3z">Arucas</a> je zajímavé zejména tím, že v něm sídlí <a href="https://goo.gl/maps/TkoVC9AuKw22">destilérka Arehucas</a>, která vyrábí stejnojmenný rum. A hlavně dělají prohlídky továrny (všední dny do 13h), které končí ochutnávkou... (tenhle výlet se opravdu autem nevyplatí)</p>

<p>Abyste neměli pocit, že jedete jen za alkoholem, tak můžete navštívit kostel <a href="https://goo.gl/maps/1Bxob3dGXTw">Parroquia de San Juan Bautista</a> a vylézt na <a href="https://goo.gl/maps/kxuWtyFGEL42">Mirador de Arucas</a>.</p>

<p><img src="/data/2017/2017-03-07-las-palmas-gran-canaria-kam-na-vylety/arehucas.jpg" alt="Arehucas" /></p>

<h3 id="caldera-de-bandama">Caldera de Bandama</h3>

<p><a href="https://goo.gl/maps/FdY27StZAQ42">Caldera de Bandama</a> je sopečný kráter, který nabízí různé možnosti zábavy. Můžete ho obejít dokola, slézt dovnitř (kde nějaký pán pěstuje zeleninu, pozor, také zavírá vrátka nahoře myslím v 17 h) a také vylézt na <a href="https://goo.gl/maps/Zb6vZQsLtq92">Pico de Bandama</a>, odkud jsou parádní výhledy.</p>

<p>Všechny tři části v jeden den jsou docela náročné, takže doporučuji obejití dokola nechat nakonec a případně vynechat úplně.</p>

<h3 id="firgas-a-%E3%BAdol%E3%AD-azulaje">Firgas a údolí Azulaje</h3>

<p>Do <a href="https://goo.gl/maps/V14brysq6rM2">Firgasu</a> můžete dojet autobusem a použít ho jako výchozí místo na výlet do údolí Azulaje. Záznam z <a href="https://www.wikiloc.com/wikiloc/view.do?id=16683495">naší trasy je na wikiloc</a> (jen pozor, chybí začátek, než jsem si vzpomněl na zapnutí trackování).</p>

<p>Z Firgasu nejdříve sestoupíte k areálu bývalých lázní, který si příroda postupně bere zpět. Následně pokračujete zajímavým terénem proti proudy řeky. Cestou budete přeskakovat řeku po kamenech a šplhat na skálu (na druhou stranu, cestou jsme potkali třeba i pár s malým dítětem, takže to zas tak náročné není.).</p>

<p><img src="/data/2017/2017-03-07-las-palmas-gran-canaria-kam-na-vylety/azulaje.jpg" alt="Azulaje" /></p>

<h3 id="maspalomas">Maspalomas</h3>

<p>Pokud zrovna nebude v Las Palmas na koupání, tak můžete vyrazit na jih, do ráje německých důchodců, do <a href="https://goo.gl/maps/oeRfgwX9mX72">Maspalomas</a>. I přesto, že v Las Palmas může být třeba zataženo, tak v Maspalomas bude s nejvyšší pravděpodobností hezky.</p>

<p>Určitě si projděte <a href="https://goo.gl/maps/KToHFjQeSDn">písečné duny</a>. A dále kromě písečné pláže, nudistické pláže a gay pláže, stojí za vidění také maják <a href="https://goo.gl/maps/DpZhiSucGmJ2">Faro Maspalomas</a>.</p>

<p>Nezapomeňte si sebou vzít opalovací krém a volitelně slunečník, fakt to tam opaluje, tak ať se nespálíte.</p>

<p>Pokud pojedete autem, tak můžete zkusit zaparkovat <a href="https://goo.gl/maps/EC3yrCPuPcA2">zadarmo mezi penziony</a>, případně <a href="https://goo.gl/maps/XzaHzix41Jy">na (placeném) parkovišti</a>, které je taky kousek od pláže.</p>

<p><img src="/data/2017/2017-03-07-las-palmas-gran-canaria-kam-na-vylety/maspalomas.jpg" alt="Maspalomas" /></p>

<h3 id="jard%E3%ADn-bot%E3%A1nico-viera-y-clavijo">Jardín Botánico Viera y Clavijo</h3>

<p>Kousek za Las Palmas je docela velká a hezká botanická zahrada <a href="https://goo.gl/maps/QDyiNXDXt992">Jardín Botánico Viera y Clavijo</a>. Spíš to není to na celý den, ale určitě stojí za vidění. Takže ideální, pokud vám to vyjde cestou na jiný výlet autem.</p>

<p><img src="/data/2017/2017-03-07-las-palmas-gran-canaria-kam-na-vylety/botanicka.jpg" alt="Jardín Botánico Viera y Clavijo" /></p>

<h3 id="trek-na-playa-de-g%E3%BEig%E3%BEi">Trek na Playa de Güigüi</h3>

<p><a href="https://goo.gl/maps/TtjKcWTgReC2">Playa de Güigüi</a> je na rozdíl od jiných místních pláží speciální tím, že se na ni dá dostat jen lodí nebo trekem přes horu. My jsme zvolili variantu přes horu. Výchozím místem je Tasartico (resp. kousek za ním po prašné cestě, kde se pak dá <a href="https://goo.gl/maps/7GXXqKxuhaC2">dobře zaparkovat</a>). Pozor, do Tasartica jeďte spodem přes Mogán, silnice horem od Agaete je často zavřená (typicky se ji kus sesune). Po zaparkování se vydejte <a href="https://www.wikiloc.com/wikiloc/view.do?id=16741021">po cestě naznačené na Wikiloc</a> (pozor, je tam jen cesta tam, musíte to jít i zpátky). Pláž je opravdu opuštěná, a kromě pár hipíků, kteří mají o kousek výš postavené domečky, tam nikdo není (kromě dalších lidí, kteří tam vyrazí na výlet). Takže si nezapomeňte hodně vody a svačinu ;-) Na cestu zpět si nechte dost času (nebo si vezměte čelovky, my jsme druhou půlku cesty zpět šli potmě.</p>

<p><img src="/data/2017/2017-03-07-las-palmas-gran-canaria-kam-na-vylety/guigui.jpg" alt="Playa de Güigüi" /></p>

<h2 id="okru%E5%BEn%E3%AD-v%E3%BDlet-autem">Okružní výlet autem</h2>

<p>Následující místa se v (tomto pořadí) dají prohlédnout za jeden den. Doporučuji ohvězdičkovat v Google Map, ať podle toho pak můžete navigovat.</p>

<p>P.S. do zatáček v horách se troubí ;-) A pokud cestou potkáte nějakou pěknou vyhlídku, tak má u sebe většinou i odpočívadlo, takže se dá pokoukat.</p>

<h3 id="yacimiento-arqueol%E3%B3gico-cenobio-valer%E3%B3n">Yacimiento arqueológico Cenobio Valerón</h3>

<p><a href="https://goo.gl/maps/Q4zwXPSDwSB2">Yacimiento arqueológico Cenobio Valerón</a> jsou vykopávky na severu ostrova. Je tam spoustu jeskyní, které sloužily jako sklad obilí.</p>

<p><img src="/data/2017/2017-03-07-las-palmas-gran-canaria-kam-na-vylety/valeron.jpg" alt="Valerón" /></p>

<h3 id="los-tilos-de-moya">Los Tilos de Moya</h3>

<p><a href="https://goo.gl/maps/Bmtc9GExoFy">Los Tilos de Moya</a> je přírodní rezervace s párkilometrovým okruhem lesem. Pokud jste si zatím mysleli, že Gran Canaria je suchý kámen, tak vás návštěva vyvede z omylu. A kromě jiného tu rostou vavříny (a.k.a. bobkový list).</p>

<h3 id="moya">Moya</h3>

<p>Vesnice <a href="https://goo.gl/maps/n6zLWCkoRRL2">Moya</a> je zajímavá zejména tím, že z <a href="https://goo.gl/maps/TGJpbpYhhZU2">vyhlídky za kostelem</a> je krásný výhled od údolí.</p>

<p><img src="/data/2017/2017-03-07-las-palmas-gran-canaria-kam-na-vylety/moya.jpg" alt="Moya" /></p>

<h3 id="tejeda">Tejeda</h3>

<p><a href="https://goo.gl/maps/E86bvoyUCB92">Tejeda</a> je typická horská vesnice, kam se turisté jezdí dívat na typickou vesnici. Ale za projití stojí. Mají tam i kostel a panaderii, kde mají různá sladká pečiva.</p>

<h3 id="pico-de-las-nieves">Pico de las Nieves</h3>

<p><a href="https://goo.gl/maps/X34KLiYMgJq">Pico de las Nieves</a> nejvyšší hora Gran Canaria. Skoro až na vrchol se dá dojet autem. Je odtamtud pěkný výhled na Roque Nublo. Na úplný vrchol se ale vylézt nedá, protože tam je nějaká vojenská radiová stanice (nicméně <a href="https://goo.gl/maps/4wpWqtMysgB2">přístupná vyhlídka</a> je téměř na vrcholu, takže to je jedno).</p>

<h3 id="roque-nublo">Roque Nublo</h3>

<p><a href="https://goo.gl/maps/k3PeBCwv6Ys">Roque Nublo</a> je hora, která má na vršku kámen postavený na špičku. Zastavit můžete <a href="https://goo.gl/maps/gdzwjB3xuNC2">na parkovišti nebo podél silnice</a> a na vrchol vede asi půlhodinová procházka po kamenité cestě. Pokud je hezké počasí, tak je od vrcholu vidět Teide na Tenerife.</p>

<p><img src="/data/2017/2017-03-07-las-palmas-gran-canaria-kam-na-vylety/teide.jpg" alt="Teide od Roque Nublo" /></p>

<h3 id="presa-de-las-ni%E3%B1as">Presa De Las Niñas</h3>

<p>Od Roque Nublo vyrazte směrem k <a href="https://goo.gl/maps/3nmVgyg7mfT2">La Playa de Mogán</a>. Cestou dolů narazíte na přehradu <a href="https://goo.gl/maps/nbnYmjR1DL72">Presa De Las Niñas</a>, ke které se dá dojít (a kromě jiného tam je kemp).</p>

<h3 id="puerto-de-mog%E3%A1n">Puerto de Mogán</h3>

<p>Puerto de Mogán je přístavní město. Přístav určitě stojí za projití. A také má hezkou pláž. Když budete mít štěstí, tak vám výlet vyjde tak, že z Mogánu budete moci pozorovat západ slunce – doporučuji <a href="https://goo.gl/maps/ZS4D4n1WCG62">tohle místo</a>.</p>

<p>Z Mogánu to potom je po GC-1 a GC-2 do Las Palmas tak hodina. Na další den si neplánujte nic velkého, protože budete zničení ;-)</p>

<h3 id="plane-spotting">Plane Spotting</h3>

<p>Aneb <em>"koukání na letadla"</em>. Měli jsme v plánu, ale nestihli jsme. Mělo by se dát dojet do <a href="https://goo.gl/maps/cJ2b7FAzgUs">El Burrero</a> a odtamtud sledovat přistávající letadla.</p>

<p><strong>Tip:</strong> Případně při odjezdu doražte na letiště o něco dřív a vylezte na terasu pro kuřáky. Je odtamtud pěkný výhled na ruch na letišti. Jen tam tedy občas někdo kouří.</p>

<h2 id="co-ochutnat">Co ochutnat</h2>

<p>Samozřejmě nemůžu vynechat jídlo.</p>

<ul>
<li>Churros už jsem zmínil nahoře.</li>
<li>V obchodech mají široký výběr sušené šunky (jamón serrano). </li>
<li>Dál určitě fuet a longaniza (šušené salámy).</li>
<li>V obchoďáku můžete koupit chlazené nebo mražené krevety za €10/kilo, což je dobrý deal.</li>
<li>Tuňák v konzervě je tu levnější než v ČR, je to moje oblíbená svačina na výlety (lžičku s sebou!).</li>
<li>Ve větších obchodech vám u rybího pultu rádi nakrojí plátky z čerstvého tuňáka. </li>
<li>V kavárnách si rád dávám café con leche, což je espreso s trochou našlehaného mléka.</li>
</ul>

<h2 id="z%E3%A1v%E4%9Brem">Závěrem</h2>

<p>Hlavně se tu nesnažte strhnout všechny výlety za pár dnů a raději odpočívejte a relaxujte.</p>
]]></content>
        </entry>
            <entry>
            <title type="html"><![CDATA[Návrhový vzor Null Object]]></title>
            <link href="https://blog.martinhujer.cz/null-object/"/>
            <updated>2016-11-09T00:00:00+00:00</updated>
            <id>https://blog.martinhujer.cz/null-object/</id>
            <content type="html"><![CDATA[<p>V článku předvedu, jak pomocí návrhového vzoru Null Object můžeme zjednodušit kód. Budu se snažit ukázat maximum příkladů a jen minimum teorie (na tu vás odkážu jinam).</p>

<p>Prvním příkladem je <em>volitelná</em> závislost. V následující ukázce to je <code>$logger</code>. Buď ho máme nastavený a v tom případě logujeme nebo nemáme a nelogujeme.</p>

<pre><code class="php">class DataProcessor
{
    /** @var LoggerInterface */
    private $logger;

    public function setLogger(LoggerInterface $logger)
    {
        $this-&gt;logger = $logger;
    }

    public function processData($data)
    {
        if ($this-&gt;logger !== null) {
            $this-&gt;logger-&gt;log('Processing started!');
        }

        // some work...

        if ($this-&gt;logger !== null) {
            $this-&gt;logger-&gt;log('Processing finished!');
        }
    }
}

interface LoggerInterface
{
    public function log($message);
}

class StdoutLogger implements LoggerInterface
{
    public function log($message)
    {
        echo $message;
    }
}
</code></pre>

<p>Použití třídy pak může vypadat takto</p>

<pre><code class="php">$processor = new DataProcessor();
$processor-&gt;setLogger(new StdoutLogger());
$processor-&gt;processData([]); // máme a logujeme

$processorWithoutLogging = new DataProcessor();
$processorWithoutLogging-&gt;processData([]); // nemáme a nelogujeme
</code></pre>

<p>Kromě toho, že dependency injection pomocí setteru je špatně (existuje instance v nekonzistentním stavu), tak kontroly <code>null</code> zbytečně zesložiťují metodu <code>processData()</code>.</p>

<p>Tady přichází ke slovu návrhový vzor Null Object. Místo, abychom se rozhodovali, jestli logger nastavíme nebo ne, tak ho nastavíme vždy. Ideálně pomocí contructor injection. Díky tomu můžeme odebrat podmínky v metodě <code>processData()</code>:</p>

<pre><code class="php">class DataProcessor
{
    /** @var LoggerInterface */
    private $logger;

    public function __construct(LoggerInterface $logger)
    {
        $this-&gt;logger = $logger;
    }

    public function processData($data)
    {
        $this-&gt;logger-&gt;log('Processing started!');

        // some work...

        $this-&gt;logger-&gt;log('Processing finished!');
    }

}
</code></pre>

<p>Protože bez instance loggeru nemůžeme vytvořit <code>DataProcessor</code>, vytvoříme třídu <code>NullLogger</code>, která implementuje rozhraní <code>LoggerInterface</code>, ale nikam neloguje.</p>

<pre><code class="php">class NullLogger implements LoggerInterface
{
    public function log($message)
    {
        // intentionally does nothing
    }
}

$processor = new DataProcessor(new StdoutLogger());
$processor-&gt;processData([]); // máme a logujeme

$processorWithoutLogging = new DataProcessor(new NullLogger());
$processorWithoutLogging-&gt;processData([]); // máme, ALE NELOGUJEME
</code></pre>

<p>Odsunuli jsme starost o <code>null</code> mimo třídu, čímž jsme elegantně zjednodušili kód <code>DataProcessor</code>. Jde vlastně o příklad použití polymorfismu - místo speciálního chování podle typu delegujeme řešení na tu samotnou třídu.</p>

<h2 id="co-situace%2C-kdy-to-pot%E5%99ebuji-rozli%E5%A1it%3F">Co situace, kdy to potřebuji rozlišit?</h2>

<p>Samozřejmě ne vždy to půjde takhle snadno jako v tomto případě. Cílem návrhového vzoru je zjednodušit většinu použití, ale zároveň umožnit rozlišení tam, kde to je nezbytné.</p>

<p>Jako první možnost odlišení vás asi napadne:</p>

<pre><code class="php">if ($this-&gt;logger instanceof NullLogger) {
</code></pre>

<p>Ale to by znamenalo porušení Dependency Inversion Principle a zároveň bychom nemohli použít několik různých Null objektů. Fowler (2012) na to navrhuje dvě řešení:</p>

<ol>
<li>V interface vytvořit metodu <code>public function isNull(): bool;</code>, která v konkrétních implementacích bude buď vracet <code>true</code> nebo <code>false</code>.</li>
<li>Pokud nemůžeme měnit rozhraní a ostatní třídy, můžeme vytvořit <code>interface Null { }</code> a implementovat ho v našich Null třídách.</li>
</ol>

<p>Použití  pak může vypadat takto:</p>

<ol>
<li>speciální metoda:</li>
</ol>

<pre><code class="php">if ($this-&gt;logger-&gt;isNull()) {
    // chování pro null
}
</code></pre>

<ol start="2">
<li>implementované rozhraní: </li>
</ol>

<pre><code class="php">if ($this-&gt;logger instanceof Null) {
    // chování pro null
}
</code></pre>

<h2 id="jak-refaktorovat-st%E3%A1vaj%E3%ADc%E3%AD-k%E3%B3d%3F">Jak refaktorovat stávající kód?</h2>

<p>Fowler ukazoval Null Object v knize <em>Refactoring - Improving the Design of Existing Code</em> (Fowler, 2012, p260) a mně se hodně líbilo, jak to refaktoroval po malých "baby-steps" (co nejmenší bezpečné kroky, čím se minimalizuje riziko, že něco rozbijeme). Zjednodušeně je tu popíšu na od něj vypůjčeném a upraveném příkladu.</p>

<p>Máme zákazníka, který má přiřazenou úroveň slev:</p>

<pre><code class="php">class DiscountLevel
{
    const NONE = 'none';
    const PREMIUM = 'premium';
}

class Customer
{
    public function getDiscountLevel() { ... }
}
</code></pre>

<p>A použití zákazníka vypadá takto:</p>

<pre><code class="php">if ($customer === null) {
    $discountLevel = DiscountLevel::NONE;
} else {
    $discountLevel = $customer-&gt;getDiscountLevel();
}

// případně takto
if ($customer !== null) {
    $entityManager-&gt;persist($customer);
}
</code></pre>

<p>Prvním krokem refaktoringu je přidání metody <code>isNull()</code> a vytvoření <code>NullCustomer</code> jako potomka <code>Customer</code> (jen se změněným chováním metody <code>isNull()</code>). Zároveň v tomto kroku musíme změnit <strong>všechna</strong> porovnání s <code>null</code> na volání <code>-&gt;isNull()</code> (<code>$customer</code> už nikdy nebude <code>null</code>, takže by to jinak rozbilo stávající kód)</p>

<pre><code class="php">class Customer
{
    public function getDiscountLevel() { ... }

    public function isNull()
    {
        return false;
    }
}

class NullCustomer extends Customer
{
    public function isNull()
    {
        return true;
    }
}

if ($customer-&gt;isNull()) {
    $discountLevel = DiscountLevel::NONE;
} else {
    $discountLevel = $customer-&gt;getDiscountLevel();
}

if (!$customer-&gt;isNull()) {
    $entityManager-&gt;persist($customer);
}
</code></pre>

<p>Následně budeme procházet jednotlivá použití a zkoumat, zda je pomocí Null Objectu můžeme zjednodušit.</p>

<p>Nejdříve se podíváme na <code>getDiscountLevel()</code>. Stačí, pokud tu metodu v <code>NullCustomer</code> překryjeme, aby vždy vracela <code>DiscountLevel::NONE</code> a můžeme podmínku úplně zrušit.</p>

<pre><code class="php">// Customer se nemění

class NullCustomer extends Customer
{
    public function isNull() {...};

    public function getDiscountLevel()
    {
        return DiscountLevel::NONE;
    }
}

// tady jsme zrušili složitý if
$discountLevel = $customer-&gt;getDiscountLevel();
</code></pre>

<p>V druhé situaci, při persistování do databáze, se podmínky nezbavíme. Šlo by to vyřešit úpravou persistování, aby kontrolovalo, jestli nepředáváme objekt implementující <code>Null</code> interface a to důsledně implementovat u všech Null objektů. Ale to by spíš vedlo ke znepřehlednění než zpřehlednění.</p>

<pre><code class="php">// tady if zůstal
if (!$customer-&gt;isNull()) {
    $entityManager-&gt;persist($customer);
}
</code></pre>

<p>Na složitějším příkladu jsme si ukázali, jak můžeme zjednodušit existující kód zavedením Null Objectu a že ne ve všech situacích to je možné.</p>

<h2 id="p%E3%A1r-stru%E4%9Dn%E3%A1ch-pozn%E3%A1mek">Pár stručnách poznámek</h2>

<ul>
<li>Null Object se často používá při implementaci návrhového vzoru Strategy (jako nejjednodušší strategie, kterou můžeme vytvořit)</li>
<li>Klidně je možné vytvořit více různých Null objektů pro jeden reálný typ</li>
<li>Null objekt by se nikdy neměl změnit v reálný objekt (pokud to potřebujeme, tak by to od začátku měl být reálný objekt, který se jen dočasně chová jako Null objekt)</li>
</ul>

<h2 id="shrnut%E3%AD">Shrnutí</h2>

<p>Návrhový vzor Null Object se snaží řešit opakovaný kód pro kontrolu, zda máme k dispozici instanci třídy. Místo porovnávání s <code>null</code> vytvoříme třídu se strejným rozhraním, ale s prázdným nebo defaultním chováním. Tím odsunujeme problém z kódu, který třídu používá o úroveň výše.</p>

<p><strong>Slyšeli jste o tomto návrhovém vzoru už dříve? Používáte ho ve své aplikaci? Budu rád, pokud se podělíte o další příklady v komentářích.</strong></p>

<h2 id="zdroje">Zdroje</h2>

<ul>
<li>FOWLER, Martin, Kent BECK, John BRANT, William OPDYKE a Don ROBERTS. <em>Refactoring: Improving the Design of Existing Code.</em> Addison-Wesley, 2012. ISBN 9780133065268.</li>
<li><a href="https://www.tutorialspoint.com/design_pattern/null_object_pattern.htm">https://www.tutorialspoint.com/design_pattern/null_object_pattern.htm</a></li>
<li><a href="https://sourcemaking.com/design_patterns/null_object">https://sourcemaking.com/design_patterns/null_object</a></li>
<li><a href="https://www.cs.oberlin.edu/~jwalker/nullObjPattern/">https://www.cs.oberlin.edu/~jwalker/nullObjPattern/</a></li>
</ul>
]]></content>
        </entry>
            <entry>
            <title type="html"><![CDATA[Platební karta Revolut]]></title>
            <link href="https://blog.martinhujer.cz/revolut-karta/"/>
            <updated>2016-11-08T00:00:00+00:00</updated>
            <id>https://blog.martinhujer.cz/revolut-karta/</id>
            <content type="html"><![CDATA[<p>Na výběry z bankomatů v zahraničí a na placení na podezřelých webech jsem si pořídil <a href="https://revolut.com/">Revolut kartu</a>.</p>

<p><img src="/data/2016/2016-11-08-revolut-karta/revolut-logo.jpg" alt="Revolut logo" /></p>

<h2 id="funguje-to-n%E3%A1sledovn%E4%9B%3A">Funguje to následovně:</h2>

<ol>
<li>nainstalujete si mobilní aplikaci</li>
<li>vyplníte své údaje</li>
<li>necháte si vystavit kartu (pro online placení je k dispozici ihned)</li>
<li>počkáte, než vám doručí fyzickou MasterCard - je to britský startup a karta z UK přišla rychleji než z Fio banky</li>
<li>aktivujete ji v aplikaci</li>
<li>převedete si na Revolut účet peníze z jiné karty nebo banky</li>
<li>vybíráte a platíte</li>
</ol>

<h2 id="na-co-se-hod%E3%AD%3F">Na co se hodí?</h2>

<p>Já Revolut používám zejména na výběry z bankomatu v cizině. Nechci u sebe mít zbytečně hodně peněz v hotovosti (všechno co jde, se snažím platit kartou), takže nejradši vybírám po €40. S českou platební kartou, kde typicky účtují fixní poplatek a procenta z vybírané částky bych se nedoplatil. Takže to dělám tak, že českou Airbank kartou dobíjím Revolut účet (za relativně férový Airbank kurz) a vybírám Revolut kartou. Mají zdarma neomezený počet výběrů do objemu £500 měsíčně (což je teď vlastně i přibližně €500).</p>

<p>Kromě vybírání z bankomatu kartu používám na placení na podezřelých webech, kde je nutné zadat číslo karty přímo do webu. V mobilní aplikaci lze totiž u karty zvlášť povolit nebo vypnout platby online, takže na platbu na podezřelém webu je zapnu a pak zase vypnu.</p>

<p>Ještě by měla umět snadno převádět peníze mezi jednotlivými uživateli, ale to jsem zatím nezkoušel.</p>

<h2 id="nev%E3%BDhody">Nevýhody</h2>

<p>Nevýhodou může být, že jediným způsobem, jak Revolut kartu získat a ovládat je pomocí mobilní aplikace (je podobně jako třeba Whatsapp navázaná na telefonní číslo). Ale na druhou stranu to je hodně příjemné - např. zobrazí notifikaci v okamžiku zaplacení.</p>

<p>Zároveň je složitější z ní převést peníze zpět na český účet (myslím, že tam je nějaký poplatek za mezinárodní platbu), takže si tam dobíjím je částky, které stejně brzy vyberu.</p>

<p>Na jejich Facebook stránce jsem zachytil, že psali o nějakém výpadku, takže určitě na ni nespoléhejte jako na jedinou kartu (ale to ani na žádnou jinou!).</p>

<h2 id="shrnut%E3%AD">Shrnutí</h2>

<p>Jestli se chystáte do zahraničí a víte, že budete častěji vybírat z bankomatu, tak Revolut určitě vyzkoušejte.</p>

<p>Pokud při registraci zadáte v aplikaci zadáte promo kód <code>martinpri</code>, tak bychom oba měli od Revolutu dostat nějaké bonusové fufníky.</p>
]]></content>
        </entry>
    </feed>